{
  "metadata": {
    "task_name": "PHASE_4B_VARIABLES_AND_REMAINING_IMPORTS_CLEANUP",
    "task_id": "TASK_2025_12_26_QWEN_PHASE4B",
    "phase": "4B",
    "complexity": "MEDIUM_RISK_HIGH_VOLUME",
    "execution_mode": "careful_validation_per_edit",
    "assigned_role": "executor",
    "recommended_model": "qwen-coder-2.5-32b",
    "estimated_time": "45-60 minutes",
    "target_reduction": "60-70 warnings",
    "baseline_warnings": "410 (post-Gemini Phase 4A @ 6a5e2485)",
    "previous_phase": "Phase 4A by Gemini: 475 ‚Üí 410 (-65 warnings)"
  },

  "critical_constraints": {
    "ABSOLUTE_RULES": [
      "ONLY remove variables/imports that are PROVABLY unused throughout ENTIRE file",
      "VALIDATE with TypeScript AFTER EVERY SINGLE EDIT (not just batches)",
      "NEVER remove 'err' parameters in catch blocks",
      "NEVER touch 'no-explicit-any' warnings",
      "STOP immediately if ANY file shows TypeScript errors",
      "READ ENTIRE file before removing any variable (may be used in conditional/future code)"
    ],
    "FILES_TO_SKIP": [
      "Any file with 'err' in catch block for the specific warning",
      "Any file with TODO/FIXME near unused variable/import",
      "Any file you're uncertain about after reading completely",
      "Test files (*/test/*, *.test.tsx, *.spec.ts)"
    ],
    "ROLLBACK_TRIGGERS": [
      "TypeScript errors appear",
      "Warnings increase",
      "Build fails",
      "Uncertainty about variable usage"
    ]
  },

  "scope_definition": {
    "target_warnings": {
      "total_warnings": 410,
      "breakdown": {
        "no_unused_vars": 268,
        "no_explicit_any": 142
      },
      "phase_4b_targets": "ONLY no-unused-vars (268 targets)",
      "explicitly_excluded": "no-explicit-any (requires refactoring, HIGH RISK)"
    },
    "target_types": {
      "destructured_variables": {
        "description": "Variables from destructuring that aren't used",
        "examples": [
          "const { user, token } = useAuth() // 'user' unused",
          "const { data, isLoading } = useQuery() // 'data' unused"
        ],
        "count": "20-30 targets",
        "risk": "LOW",
        "priority": 1
      },
      "remaining_icon_imports": {
        "description": "Icons from lucide-react that Phase 4A missed",
        "common": ["Star", "Eye", "Calendar", "User", "Filter", "Activity", "Plus", "Video"],
        "count": "40-50 targets",
        "risk": "LOW",
        "priority": 2
      },
      "unused_handlers": {
        "description": "Event handlers defined but never connected",
        "examples": ["handleSave", "handleUserUpdated", "handleUserCreated"],
        "count": "15-20 targets",
        "risk": "MEDIUM (verify entire file first)",
        "priority": 3
      },
      "unused_components": {
        "description": "Remaining UI components not rendered",
        "examples": ["Card", "StatusChip", "ErrorMessage"],
        "count": "10-15 targets",
        "risk": "MEDIUM (check conditional rendering)",
        "priority": 4
      },
      "callback_parameters": {
        "description": "Unused parameters in callbacks (map, forEach, etc)",
        "examples": [".map((data, index) => ...) // 'index' unused"],
        "count": "10-15 targets",
        "risk": "HIGH (can break keys, may be needed)",
        "priority": 5,
        "recommendation": "SKIP for now"
      }
    }
  },

  "verification_protocol": {
    "before_starting": [
      "STEP 1: Read @QWEN_PHASE4B_CRITICAL_ADDITIONS.md - MANDATORY",
      "STEP 2: Verify clean state: git status (should be clean)",
      "STEP 3: Create checkpoint branch: git checkout -b phase4b-cleanup",
      "STEP 4: Create baseline commit: git commit --allow-empty -m '[CHECKPOINT] Phase 4B baseline: 410 warnings'",
      "STEP 5: Run baseline: npm run lint 2>&1 | tail -5 (should show 410 warnings)",
      "STEP 6: Count targets: npm run lint 2>&1 | grep 'no-unused-vars' | wc -l (should show 268)"
    ],
    "for_each_file": {
      "step_1_read_entire_file": {
        "action": "Read COMPLETE file from top to bottom",
        "purpose": "Understand context, find conditional usage, spot TODOs",
        "tool": "Read tool with no limit, or cat entire file"
      },
      "step_2_identify_unused_safely": {
        "for_imports": {
          "method_1": "grep '<ImportName' file.tsx (JSX usage)",
          "method_2": "grep 'ImportName' file.tsx | grep -v import (variable usage)",
          "safe_if": "Both return 0 results"
        },
        "for_variables": {
          "method_1": "grep '\\bvariableName\\b' file.tsx (exact word match)",
          "method_2": "Visual inspection of entire file",
          "safe_if": "Only appears in definition line"
        },
        "for_handlers": {
          "method_1": "grep 'onClick.*handlerName' file.tsx",
          "method_2": "grep 'onSubmit.*handlerName' file.tsx",
          "method_3": "grep '{handlerName}' file.tsx (as prop)",
          "safe_if": "All return 0 results AND no TODO mentions it"
        }
      },
      "step_3_remove_carefully": {
        "for_imports": "Delete only the unused import from import statement",
        "for_destructured_variables": "Remove only unused properties from destructuring",
        "for_standalone_variables": "Delete entire declaration line",
        "for_handlers": "Delete entire function definition"
      },
      "step_4_validate_immediately": {
        "command_1": "npx tsc --noEmit 2>&1 | head -20",
        "command_2": "npx eslint frontend/src/path/to/file.tsx",
        "success_criteria": [
          "TypeScript: 0 new errors",
          "ESLint: warnings decreased or stayed same (NEVER increased)"
        ],
        "on_failure": "git checkout frontend/src/path/to/file.tsx && STOP && REPORT"
      },
      "step_5_commit_incrementally": {
        "when": "After every 3-5 successful file edits",
        "command": "git add . && git commit -m '[CLEANUP] Remove unused vars from 3-5 files'",
        "benefit": "Easy rollback to last known good state"
      }
    },
    "after_each_batch_of_5_files": [
      "npm run lint 2>&1 | tail -5 (check total warnings decreasing)",
      "npx tsc --noEmit (verify 0 errors)",
      "git diff --stat (review changes)",
      "If all OK: continue. If NOT: git reset --hard HEAD~1 && INVESTIGATE"
    ]
  },

  "high_value_targets": {
    "file_1_liveevent_admin": {
      "path": "frontend/src/pages/admin/LiveEvent.tsx",
      "warning_count": 15,
      "targets": [
        "Plus (icon import)",
        "Radio (icon import)",
        "Video (icon import)",
        "ActivityIcon (icon import)",
        "XCircleIcon (icon import)",
        "AlertTriangle (icon import)",
        "SSEEventType (type import)",
        "eventId (variable)",
        "currentFight (variable)",
        "singleEventLoading (variable)",
        "lastEvent (variable - CHECK TODO first)",
        "sseError (variable)",
        "data (callback param - line 842, 850)"
      ],
      "estimated_reduction": "10-13 warnings",
      "risk_level": "MEDIUM",
      "special_notes": "Large file (850+ lines), read completely before editing"
    },
    "file_2_events_user": {
      "path": "frontend/src/pages/user/Events.tsx",
      "warning_count": 8,
      "targets": [
        "Calendar (icon)",
        "Eye (icon)",
        "User (icon)",
        "Filter (icon)",
        "initialEvents (variable)",
        "initialLoading (variable)",
        "useCallback (React hook)",
        "useRef (React hook)"
      ],
      "estimated_reduction": "6-8 warnings",
      "risk_level": "LOW-MEDIUM"
    },
    "file_3_venues_admin": {
      "path": "frontend/src/components/admin/Venues.tsx",
      "warning_count": 6,
      "targets": [
        "User (icon)",
        "Mail (icon)",
        "MapPin (icon)",
        "StatusChip (component)",
        "handleSave (handler)",
        "err (catch param - SKIP THIS ONE)"
      ],
      "estimated_reduction": "5 warnings (skip 'err')",
      "risk_level": "MEDIUM"
    },
    "file_4_users_admin": {
      "path": "frontend/src/pages/admin/Users.tsx",
      "warning_count": 5,
      "targets": [
        "handleUserUpdated (handler)",
        "handleUserCreated (handler)",
        "err (catch param - lines 242, 304 - SKIP BOTH)"
      ],
      "estimated_reduction": "2 warnings (skip err warnings)",
      "risk_level": "HIGH (handlers may be for future features)"
    }
  },

  "examples": {
    "SAFE_TO_REMOVE_destructured_variable": {
      "before": "const { user, token, isBettingEnabled } = useAuth()\nconsole.log(token, isBettingEnabled)",
      "verification": "grep '\\buser\\b' file.tsx | grep -v 'const { user' returns ONLY the destructuring line",
      "after": "const { token, isBettingEnabled } = useAuth()\nconsole.log(token, isBettingEnabled)",
      "impact": "-1 warning"
    },
    "SAFE_TO_REMOVE_unused_handler": {
      "before": "const handleSave = () => { /* logic */ }\nconst handleDelete = () => { /* logic */ }\nreturn <Button onClick={handleDelete}>Delete</Button>",
      "verification": "grep -E '(onClick|onSubmit|{handleSave})' file.tsx returns 0 results for handleSave",
      "after": "const handleDelete = () => { /* logic */ }\nreturn <Button onClick={handleDelete}>Delete</Button>",
      "impact": "-1 warning"
    },
    "SAFE_TO_REMOVE_remaining_icon": {
      "before": "import { Star, Eye, Calendar, ArrowRight } from 'lucide-react'\nreturn <div><ArrowRight /></div>",
      "verification": "grep '<Star\\|<Eye\\|<Calendar' file.tsx returns 0 results",
      "after": "import { ArrowRight } from 'lucide-react'\nreturn <div><ArrowRight /></div>",
      "impact": "-3 warnings"
    },
    "DO_NOT_REMOVE_catch_err": {
      "code": "try {\n  await api.call()\n} catch (err) {\n  console.error('Error')\n}",
      "reason": "'err' flagged as unused but needed for debugging",
      "action": "SKIP this warning - do NOT remove 'err' parameter"
    },
    "DO_NOT_REMOVE_planned_feature": {
      "code": "const { lastEvent, currentEvent } = useEvents()\n// TODO: Implement event history comparison\nreturn <div>{currentEvent.name}</div>",
      "reason": "'lastEvent' unused now but planned for future feature",
      "action": "SKIP - do NOT remove lastEvent"
    },
    "MEDIUM_RISK_callback_parameter": {
      "code": "events.map((data, index) => (\n  <EventCard key={index} event={data} />\n))",
      "issue": "'index' used only in key (warning may appear)",
      "consideration": "If removed, need alternative key (data.id)",
      "recommendation": "SKIP unless you can verify data.id exists and is unique"
    }
  },

  "execution_plan": {
    "phase_4b_1_high_value_files": {
      "priority": 1,
      "files": [
        "frontend/src/pages/admin/LiveEvent.tsx (15 warnings)",
        "frontend/src/pages/user/Events.tsx (8 warnings)",
        "frontend/src/components/admin/Venues.tsx (6 warnings)"
      ],
      "approach": "Start with these for maximum impact",
      "batch_size": 1,
      "validation_per_file": "MANDATORY - TypeScript + ESLint after EACH",
      "estimated_reduction": "20-25 warnings"
    },
    "phase_4b_2_remaining_icons": {
      "priority": 2,
      "target_pattern": "import.*{.*}.*from 'lucide-react'",
      "icons_to_find": ["Star", "Eye", "Calendar", "User", "Filter", "Activity", "Plus", "Video"],
      "approach": "Same as Phase 4A - grep for usage, remove if unused",
      "batch_size": 5,
      "estimated_reduction": "30-40 warnings"
    },
    "phase_4b_3_destructured_variables": {
      "priority": 3,
      "pattern_examples": [
        "const { user } = useAuth() // user unused",
        "const { data } = useQuery() // data unused",
        "const { isBettingEnabled } = useFeatureFlags() // unused"
      ],
      "approach": "Read file, verify usage, remove from destructuring",
      "batch_size": 3,
      "estimated_reduction": "10-15 warnings"
    },
    "phase_4b_4_unused_components": {
      "priority": 4,
      "components": ["Card", "StatusChip", "ErrorMessage"],
      "extra_caution": "Verify not used in conditional rendering (ternary, &&, etc)",
      "batch_size": 3,
      "estimated_reduction": "5-10 warnings"
    }
  },

  "safety_checklist_per_edit": {
    "before_edit": [
      "‚úì Read ENTIRE file (not just snippet)",
      "‚úì Search for variable usage throughout file",
      "‚úì Check for TODO/FIXME comments mentioning variable",
      "‚úì Verify not used in conditional/ternary expressions",
      "‚úì Confirm not passed as prop to components"
    ],
    "during_edit": [
      "‚úì Remove ONLY the unused variable/import",
      "‚úì Keep syntax valid (commas, brackets, etc)",
      "‚úì Don't accidentally remove used variables on same line"
    ],
    "after_edit": [
      "‚úì Run: npx tsc --noEmit",
      "‚úì Run: npx eslint <file>",
      "‚úì Verify warnings decreased",
      "‚úì If any error: git checkout <file> immediately"
    ],
    "abort_conditions": [
      "‚ùå TypeScript shows errors",
      "‚ùå ESLint warnings increased",
      "‚ùå Uncertain about variable usage",
      "‚ùå Found TODO mentioning the variable",
      "‚ùå Variable is 'err' in catch block"
    ]
  },

  "reporting_format": {
    "progress_update_every_5_files": {
      "files_processed": "count",
      "warnings_removed": "count",
      "current_total": "baseline - removed",
      "errors_encountered": "list or 'none'"
    },
    "final_report": {
      "total_files_modified": "count",
      "total_warnings_removed": "count",
      "warnings_before": "410",
      "warnings_after": "target: ‚â§350",
      "warnings_reduction": "actual reduction",
      "typescript_errors": "0 (required)",
      "validation_passed": "yes/no",
      "commit_ready": "yes/no"
    }
  },

  "commit_strategy": {
    "incremental_commits": {
      "frequency": "Every 3-5 successfully edited files",
      "message_format": "[CLEANUP] Phase 4B - Remove unused vars from <file_names>",
      "benefit": "Easy rollback to last known good state"
    },
    "final_commit": {
      "when": "All validations pass AND target met (warnings ‚â§350)",
      "message_template": "[CLEANUP] Phase 4B - Variables and remaining imports cleanup\n\n## Summary\nPhase 4B: Cleanup of remaining unused variables, handlers, and imports missed in Phase 4A.\n\n## Changes Made\n- Removed {X} unused variables from destructuring\n- Removed {Y} unused icon imports (Star, Eye, Calendar, etc)\n- Removed {Z} unused event handlers\n- Removed {W} unused UI component imports\n- Files modified: {count}\n\n## Validation Results\n- ‚úÖ Warnings: 410 ‚Üí {final} (-{reduction})\n- ‚úÖ TypeScript: 0 errors\n- ‚úÖ ESLint: {final} ‚â§ 350 (lint passes)\n- ‚úÖ Build: npm run build successful\n\n## Method\nVerified each removal via:\n1. Complete file reading and context analysis\n2. Variable usage search (grep + visual inspection)\n3. Immediate TypeScript validation after each edit\n4. Incremental commits for safe rollback\n\n## High Impact Files\n- LiveEvent.tsx: -15 warnings\n- Events.tsx: -8 warnings\n- Venues.tsx: -5 warnings\n\nü§ñ Generated with Claude Code\nCo-Authored-By: Qwen Coder 2.5 <noreply@qwen.com>"
    }
  },

  "rollback_plan": {
    "single_file_issue": "git checkout frontend/src/path/to/file.tsx",
    "batch_issue": "git reset --hard HEAD~1 (rollback last commit)",
    "multiple_errors": "git reset --hard <last_good_commit_hash>",
    "nuclear_option": "git checkout main && git branch -D phase4b-cleanup"
  },

  "success_criteria": {
    "minimum_requirements": [
      "Total warnings ‚â§350 (so 'npm run lint' passes without 'too many warnings' error)",
      "Warnings reduced by at least 40 (410 ‚Üí 370 or better)",
      "Zero new TypeScript errors",
      "Zero new ESLint errors",
      "All modified files compile successfully",
      "No functionality broken (no runtime errors)"
    ],
    "optimal_outcome": [
      "Total warnings ‚â§340 (410 ‚Üí 340, reduction of 70)",
      "30-50 files cleaned",
      "Clean git history with incremental commits",
      "npm run build succeeds",
      "All validations green"
    ],
    "realistic_target": "410 ‚Üí 350 (-60 warnings, -14.6%)",
    "stretch_goal": "410 ‚Üí 330 (-80 warnings, -19.5%)"
  },

  "final_instructions_for_qwen": {
    "READ_FIRST": [
      "This is Phase 4B - continuation of Phase 4A (Gemini already did -65)",
      "You're removing VARIABLES and REMAINING IMPORTS, not just icons",
      "HIGHER RISK than Phase 4A - variables can break logic",
      "VALIDATE AFTER EVERY SINGLE EDIT - not just batches",
      "When in doubt about a variable - SKIP IT"
    ],
    "EXECUTION_SEQUENCE": [
      "1. Create phase4b-cleanup branch + baseline commit",
      "2. Start with LiveEvent.tsx (highest value - 15 warnings)",
      "3. Validate IMMEDIATELY after each edit",
      "4. Commit every 3-5 files",
      "5. Process Events.tsx, Venues.tsx (high value)",
      "6. Continue with remaining icons (like Phase 4A)",
      "7. Tackle destructured variables",
      "8. Final validation",
      "9. Merge if ‚â§350 warnings achieved"
    ],
    "ABORT_CONDITIONS": [
      "If ANY file shows TypeScript errors ‚Üí revert that file",
      "If total warnings increase ‚Üí revert last commit",
      "If uncertain about variable usage ‚Üí SKIP that file",
      "If you see 'err' in catch block ‚Üí SKIP that specific warning",
      "If warnings won't go below 360 after 30 files ‚Üí STOP and report progress"
    ],
    "QUALITY_GATES": [
      "TypeScript MUST pass after every edit",
      "Warnings MUST decrease or stay same (never increase)",
      "Read ENTIRE file before removing any variable",
      "Verify variable not used in conditionals/ternaries",
      "Confirm no TODO/FIXME mentions the variable"
    ],
    "REMEMBER": "Phase 4A was LOW RISK (icons). Phase 4B is MEDIUM RISK (variables). Be MORE careful, validate MORE frequently."
  }
}

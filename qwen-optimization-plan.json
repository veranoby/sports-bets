{
  "ğŸ”´_SESSION_START_PROTOCOL": {
    "executor_model": "qwen3-coder-plus-2025-09-23",
    "role": "executor",
    "execution_mode": "standard",
    "session_declaration": "Output at start: 'Model: qwen3-coder-plus-2025-09-23 | Role: executor | Mode: standard | Task: Priority 1 /admin/events optimization'",
    "task_echo_back": "MANDATORY - Read entire PLAN section, echo back 3 tasks (TASK_2 â†’ TASK_1 â†’ TASK_3 order), confirm understanding before coding"
  },

  "ğŸ”´_DIRECTOR_PLANNING_PROTOCOL_REFERENCE": {
    "protocol_file": "brain/multi_ai_coordination_strategy.json lines 79-100",
    "critical_rules_applied": [
      "Line 82: This plan was created by director AFTER reading coordination strategy",
      "Line 92-98: Plan includes session_start_protocol, reporting_location, evidence_requirements, reference_to_protocols",
      "Reporting_location specified at line 250",
      "Evidence requirements specified at line 280"
    ]
  },

  "task": "Priority 1 Optimization: Fix /admin/events unified hub UX issues and reduce code duplication",
  "business_impact": "~80-250 lines code reduction, Quick Actions now functional, type safety improved, zero features removed",
  "priority": "PRIORITY_1_ONLY",
  "executor": "qwen3-coder-plus-2025-09-23",
  "constraints": {
    "keep_all_functionality": "MANDATORY - NO feature removal",
    "no_breaking_changes": true,
    "scope": "Only Priority 1 tasks - Quick wins (1-1.5 hours)",
    "session_management": {
      "time_limit": "90 minutes max",
      "checkpoint_frequency": "After each task completion (3 checkpoints)",
      "context_loss_handling": "If token budget exceeded, save state to qwen-checkpoint.json with current progress"
    }
  },
  "priority_1_tasks": [
    {
      "id": "TASK_2_STREAM_HOOK",
      "order": 1,
      "title": "Extract useStreamControl hook (reduce duplication)",
      "create_file": "frontend/src/hooks/useStreamControl.ts",
      "source_analysis": {
        "duplication_found": "OptimizedStreamingMonitor.tsx vs StreamingControlTab.tsx share 80+ lines",
        "handlers_duplicated": ["handleStartStream", "handleStopStream", "handlePauseStream", "handleResumeStream"],
        "utils_duplicated": ["getStatusColor function", "isLoading state"],
        "impact": "Same logic in two places = maintenance nightmare, inconsistent behavior risk"
      },
      "implementation_details": {
        "hook_signature": "export const useStreamControl = (eventId: string, eventDataCallback?: Function)",
        "return_object": {
          "handlers": "{ handleStartStream, handleStopStream, handlePauseStream, handleResumeStream }",
          "state": "{ isLoading, error, streamStatus }",
          "utilities": "{ getStatusColor(status) }"
        },
        "extract_from_lines": {
          "OptimizedStreamingMonitor": "Lines 180-240 (stream handlers), 100-120 (getStatusColor), 85-90 (isLoading state)",
          "StreamingControlTab": "Lines 150-210 (handlers), 80-95 (status color), verify logic identical"
        }
      },
      "files_modified": [
        {
          "file": "frontend/src/hooks/useStreamControl.ts",
          "action": "CREATE",
          "complexity": "MEDIUM",
          "checklist": [
            "Extract all 4 stream handler functions",
            "Extract getStatusColor to utils/statusColors.ts",
            "Extract isLoading state logic",
            "Ensure hook handles SSE subscriptions correctly",
            "Add error state and error boundaries"
          ]
        },
        {
          "file": "frontend/src/pages/admin/StreamingControlTab.tsx",
          "action": "REFACTOR",
          "lines_affected": "150-210",
          "change": "Replace inline handlers with: const { handlers, isLoading } = useStreamControl(eventId); Use handlers.handlePauseStream etc",
          "validation": "Functionality unchanged, just uses hook"
        },
        {
          "file": "frontend/src/pages/admin/OptimizedStreamingMonitor.tsx",
          "action": "REFACTOR",
          "lines_affected": "180-240",
          "change": "Replace inline handlers with hook call, eliminating 80+ duplicate lines",
          "benefit": "Single source of truth for stream control logic"
        }
      ],
      "validation_gates": [
        "Hook created successfully: frontend/src/hooks/useStreamControl.ts exists",
        "npx tsc --noEmit: No TypeScript errors",
        "Both StreamingControlTab and OptimizedStreamingMonitor import and use hook",
        "Manual test: Click pause/resume in both locations â†’ same behavior"
      ]
    },
    {
      "id": "TASK_1_QUICK_ACTIONS",
      "order": 2,
      "title": "Fix Quick Action buttons (implement real functionality)",
      "file": "frontend/src/pages/admin/Events.tsx",
      "lines": "528-545",
      "problem": "Buttons labeled 'Pausar/Reanudar Stream' but only switch tabs. UX confusion.",
      "solution": {
        "implementation": "Use useStreamControl hook from TASK_2",
        "button_logic": [
          "onClick handler calls handlePauseStream() or handleResumeStream() based on current stream status",
          "Show loading state: button disabled + text changes to 'Procesando...'",
          "After action completes, update eventDetailData stream status",
          "Show success/error toast notification"
        ],
        "code_pattern": {
          "current": "onClick={() => setActiveTab('streaming')} // Just switches tab",
          "new": "onClick={async () => { if (streamStatus === 'connected') await handlePauseStream(); setActiveTab('streaming'); }}"
        }
      },
      "files_modified": [
        {
          "file": "frontend/src/pages/admin/Events.tsx",
          "action": "UPDATE",
          "lines": "528-545 (Quick Actions section)",
          "changes": [
            "Import useStreamControl hook from TASK_2",
            "In unified hub detail view: const { handlers: streamHandlers, isLoading } = useStreamControl(eventId)",
            "Update Pause/Resume button: Call streamHandlers.handlePauseStream() or handleResumeStream()",
            "Update Other buttons: Keep tab-switch behavior but also call actions",
            "Add loading state feedback to all buttons"
          ]
        }
      ],
      "validation_gates": [
        "Quick Action 'Pausar/Reanudar' actually pauses/resumes stream (verify in SSE logs)",
        "Button shows 'Procesando...' while action in progress",
        "Tabs still switch after action completes",
        "No breaking changes to existing functionality"
      ]
    },
    {
      "id": "TASK_3_TYPES",
      "order": 3,
      "title": "Add TypeScript types (replace 'any')",
      "create_file": "frontend/src/types/events.ts",
      "problem": "Components use 'any' types â†’ IDE support poor, runtime errors possible",
      "interfaces_to_create": [
        {
          "name": "EventDetailData",
          "fields": [
            "id: string",
            "name: string",
            "location: string",
            "status: 'pending' | 'live' | 'completed' | 'paused'",
            "streamStatus: 'connected' | 'disconnected' | 'paused'",
            "createdAt: string",
            "venue: { id: string; name: string }",
            "operator: { id: string; name: string }"
          ],
          "used_in": "Events.tsx line 432"
        },
        {
          "name": "StreamStatus",
          "fields": ["status: 'connected' | 'disconnected' | 'paused'", "viewers: number", "bitrate: number"]
        },
        {
          "name": "StreamMetrics",
          "fields": ["connectionCount: number", "activeBets: number", "memoryUsage: number"]
        }
      ],
      "files_modified": [
        {
          "file": "frontend/src/types/events.ts",
          "action": "CREATE",
          "content": "Export all interfaces defined above"
        },
        {
          "file": "frontend/src/pages/admin/Events.tsx",
          "action": "UPDATE",
          "change": "Line 432: Change 'eventDetailData: any' â†’ 'eventDetailData: EventDetailData | null'",
          "imports": "Add: import { EventDetailData } from '../../types/events'"
        },
        {
          "file": "frontend/src/pages/admin/StreamingControlTab.tsx",
          "action": "UPDATE",
          "change": "Add proper types to component props: interface StreamingControlTabProps { eventId: string; eventData: EventDetailData }"
        },
        {
          "file": "frontend/src/pages/admin/FightsControlTab.tsx",
          "action": "UPDATE",
          "change": "Add proper types to component props"
        },
        {
          "file": "frontend/src/pages/admin/BetsActiveTab.tsx",
          "action": "UPDATE",
          "change": "Add proper types to component props"
        }
      ],
      "validation_gates": [
        "npx tsc --noEmit passes with zero type errors",
        "No IDE warnings on EventDetailData usage",
        "All component props properly typed",
        "Existing functionality preserved"
      ]
    }
  ],
  "implementation_sequence": {
    "order": ["TASK_2", "TASK_1", "TASK_3"],
    "reasoning": "Hook must exist before Quick Actions can use it; Types last as they depend on final structure"
  },
  "reporting_location": {
    "completion_report_file": "qwen-checkpoint.json (project root)",
    "format": {
      "session_summary": "Brief summary of what was completed",
      "task_status": "TASK_2: COMPLETED | TASK_1: COMPLETED | TASK_3: COMPLETED",
      "files_created": ["List of new files"],
      "files_modified": ["List of modified files with line ranges"],
      "validation_results": {
        "typescript_check": "Output of: npx tsc --noEmit",
        "manual_testing": "Brief notes on manual testing performed"
      },
      "evidence": {
        "code_duplication_reduction": "Before: X lines, After: Y lines, Reduction: Z lines",
        "type_coverage": "Before: N files with 'any', After: 0 files with 'any'",
        "quick_actions_functional": "âœ“ Pause/Resume buttons now call handlers, not just switch tabs"
      },
      "total_time_spent": "Actual duration in minutes"
    }
  },
  "evidence_requirements": {
    "requirement_1_code_duplication": {
      "metric": "Lines eliminated",
      "command_verify": "git diff frontend/src/pages/admin/OptimizedStreamingMonitor.tsx frontend/src/pages/admin/StreamingControlTab.tsx | wc -l",
      "expected": "~80-100 fewer lines of identical code"
    },
    "requirement_2_type_safety": {
      "metric": "TypeScript errors",
      "command_verify": "npx tsc --noEmit 2>&1 | grep -c 'error'",
      "expected": "0 errors"
    },
    "requirement_3_quick_actions": {
      "metric": "Functionality",
      "manual_test": "Click Pause button in Events.tsx sidebar â†’ Stream actually pauses (verify in SSE logs or video stop)",
      "expected": "Stream pauses, not just tab switches"
    },
    "requirement_4_breaking_changes": {
      "metric": "No regressions",
      "verification": "Tabs still switch smoothly, all original features work",
      "expected": "Zero breaking changes"
    }
  },
  "critical_do_not_do": [
    "âŒ Do NOT delete OptimizedStreamingMonitor.tsx",
    "âŒ Do NOT remove any buttons or UI elements",
    "âŒ Do NOT modify /admin/streaming routing",
    "âŒ Do NOT touch Priority 2 or 3 tasks",
    "âŒ Do NOT change tab navigation structure",
    "âŒ Do NOT implement changes beyond Priority 1 scope"
  ],
  "success_criteria": [
    "âœ“ 3 tasks completed in order (TASK_2, TASK_1, TASK_3)",
    "âœ“ ~80 lines code duplication eliminated",
    "âœ“ Quick Actions now functional (pause/resume actually work)",
    "âœ“ Type safety improved (replace 'any')",
    "âœ“ Zero features removed",
    "âœ“ npx tsc --noEmit passes",
    "âœ“ Completion report saved to qwen-checkpoint.json",
    "âœ“ Total time â‰¤ 90 minutes"
  ]
}

{
  "development_priority_stack": [
    {
      "priority": "P0_SECURITY_COMPLETED",
      "task_description": "✅ Concurrent Login Prevention + Membership Request Bug Fix + Session Cleanup",
      "completion_date": "2025-11-21",
      "rationale": "Fixed 3 critical security/revenue bugs: (1) Concurrent login vulnerability allowing credential sharing, (2) Membership acceptance bug preventing subscription upgrades, (3) Session table bloat prevention",
      "impact": "CRITICAL - Prevents credential sharing, fixes revenue-blocking bug, improves long-term database performance",
      "source_file": "brain/backlog.json (CONCURRENT_LOGIN_SECURITY_FIX_COMPLETED, MEMBERSHIP_ACCEPTANCE_BUG_FIX_COMPLETED, SESSION_CLEANUP_CRON_JOB_IMPLEMENTATION)",
      "git_commits": [
        "1b391da - feat: concurrent login prevention with session cleanup",
        "dbdecdc - fix: TypeScript row locking syntax",
        "244833c - feat: concurrent login rejection + membership acceptance fix",
        "bcf6aa7 - feat: frontend handling for concurrent login rejection"
      ],
      "testing_recommended": "Test concurrent login rejection on 2 browsers, test membership acceptance (FREE → DAILY/MONTHLY), verify session cleanup after 6 hours"
    },
    {
      "priority": "P0_CRITICAL",
      "task_description": "Solucionar Gaps de E2E Frontend y Estabilidad",
      "rationale": "La validación E2E falló en todas las capas, bloqueando la validación manual y la preparación para producción. La aplicación no es testeable ni estable en su estado actual.",
      "impact": "Bloqueador total para el lanzamiento. Sin esto, no se puede verificar que el producto funcione.",
      "source_file": "brain/backlog.json (e2e_frontend_validation_2025_11_10)"
    },
    {
      "priority": "P0",
      "task_description": "Resolver páginas de Admin rotas (Finance, Monitoring)",
      "rationale": "Las páginas de administración críticas para la operación y monitoreo del negocio no están funcionales, arrojando errores 404 y spam en la consola.",
      "impact": "Impide la gestión y monitoreo post-lanzamiento.",
      "source_file": "brain/backlog.json (broken_pages_scan_implementation_2025_11_11)"
    },
    {
      "priority": "P1_PRODUCTION_MIGRATION",
      "task_description": "Migración a Producción: Servidor Alemán + AWS con cambios streaming 2025-12-11",
      "planned_date": "Post-MVP",
      "rationale": "Live streaming implementation (2025-12-11) introdujo cambios críticos en Nginx config, env vars, HLS paths, y nuevos endpoints. Requiere plan detallado para migración segura a producción.",
      "critical_changes_2025_12_11": [
        "Nginx config: /hls/ location ahora incluye CORS headers (Access-Control-Allow-Origin: *, etc)",
        "Env vars: FEATURES_STREAMING=true habilitado, STREAM_SERVER_URL debe ser HTTP (no RTMP)",
        "Backend endpoints: POST /api/streaming/auth y /unpublish agregados para Nginx RTMP auth",
        "Stream operations: /stream/start y /stream/stop ahora idempotentes",
        "HLS path: /var/www/hls/ debe existir y ser accesible por Nginx con permisos correctos",
        "Frontend: HLSPlayer configurado con live streaming config (liveSyncDurationCount=3)",
        "streamUrl format: Ahora incluye .m3u8 extension (http://host/hls/key-name.m3u8)"
      ],
      "information_required": [
        "1. Infraestructura actual: ¿Dónde corre Nginx? (Docker/systemd/base), PostgreSQL (RDS/local), Backend (EC2/ECS/Lambda), Frontend (S3+CloudFront/EC2)?",
        "2. AWS account details: Regiones, VPCs, security groups",
        "3. German server details: IP, access method, current services running"
      ],
      "migration_tasks": [
        "1. Code deployment: Backend + Frontend build and deploy",
        "2. Nginx config update: Copy CORS headers to production nginx.conf",
        "3. Env vars update: Set FEATURES_STREAMING=true, update STREAM_SERVER_URL",
        "4. HLS directory setup: Create /var/www/hls/ with correct permissions (Nginx readable)",
        "5. Nginx reload: sudo nginx -s reload or systemctl restart nginx",
        "6. Database migration: No schema changes needed (already applied locally)",
        "7. Verification: Test RTMP auth flow, HLS playback, CORS headers",
        "8. Rollback plan: Document restore procedures in case of failure"
      ],
      "documentation_needed": [
        "Deployment Checklist (all steps in order)",
        "Configuration Migration Guide (adapt to German/AWS infrastructure)",
        "Rollback Plan (restore procedures)",
        "Verification Steps (validation checklist)"
      ],
      "source_file": "brain/backlog.json (LIVE_STREAMING_IMPLEMENTATION_2025_12_11)",
      "executor": "To be determined - requires infrastructure knowledge",
      "status": "PLANNED",
      "related_brain_files": [
        "api_endpoints_reference.json (v2.5) - streaming endpoints documented",
        "sdd_system.json - streaming_architecture_2025_12_11 section",
        "backlog.json - LIVE_STREAMING_IMPLEMENTATION_2025_12_11 task entry"
      ]
    },
    {
      "priority": "P0_INFRASTRUCTURE_DECISION_FINALIZED",
      "status": "DECIDED_AND_DOCUMENTED",
      "decision_date": "2025-11-20",
      "task_description": "OPTION B.1 FINAL: Hetzner AX42 + Nginx RTMP + PostgreSQL local + CloudFront Flat-Rate Pro",
      "rationale": "Decision crítica seleccionada (2025-11-20): Stack de streaming económico y escalable. Hetzner dedicated (self-managed, $50/mo) + Nginx RTMP ($0) + PostgreSQL local ($0) + CloudFront Flat-Rate Pro ($15/mo). Total MVP: $65/mes para 0-500 usuarios.",
      "infrastructure_details": {
        "phase_1_mvp": {
          "server": "Hetzner AX42 (8-core, 64GB RAM, 1TB NVMe, Germany) - €46/mo (~$50)",
          "operating_system": "Ubuntu Server 24.04 LTS (5 years support until 2029)",
          "streaming": "Nginx + RTMP module (open source, compiled from source)",
          "database": "PostgreSQL 18 local ($0, 30min/week maintenance)",
          "cdn": "AWS CloudFront Flat-Rate Pro Plan - $15/mo (50TB + 10M requests, NO overage charges, DDoS doesn't count)",
          "cdn_protection": "Zero surprise bills - AWS emails at 50%, 80%, 100% usage. Performance may degrade but costs stay flat.",
          "total_monthly": "$65/mo ($50 server + $15 CDN)",
          "budget_remaining": "$185/mo for monitoring, backups, contingencies",
          "supports_concurrent": "500 users",
          "performance": "Nginx CPU 150-200% (60% margin), PostgreSQL at max 20 connections (monitor closely), Disk 28-46% used"
        },
        "phase_2_scaling": {
          "trigger": "CPU >70% sustained OR disk >80% full OR PostgreSQL pool exhausted",
          "server_upgrade": "Hetzner AX102 (16-core, 128GB RAM, 3.84TB) - €150/mo (~$165)",
          "cdn_upgrade": "CloudFront Business Plan - $200/mo (50TB, 125M requests)",
          "total_monthly": "$365/mo ($165 server + $200 CDN)",
          "supports_concurrent": "800-1000 users",
          "benefits": "2× CPU headroom, eliminates connection pool bottleneck, 12+ months data growth without pressure",
          "migration_effort": "3-5 hours (pg_dump → transfer → pg_restore → DNS switch)",
          "downtime": "<30 minutes (planned maintenance)"
        },
        "phase_3_maturity": {
          "infrastructure": "Hetzner AX102 + CloudFront CDN + PostgreSQL local PERMANENT",
          "total_monthly": "$362/mo ($165 server + $197 CDN at 1000 concurrent users)",
          "supports_concurrent": "1000+ users",
          "annual_cost": "$4,344/year",
          "budget_note": "Exceeds initial $250/mo budget, requires increase to $400/mo"
        }
      },
      "business_impact": "$65/mo Phase 1, $365/mo Phase 2, $362/mo Phase 3. Saves $450 vs Option B.2 (Neon managed) if scaling gradually. Escalable a 1000+ concurrent.",
      "technical_impact": "Nginx RTMP genera HLS localmente. Video.js ya integrado. Zero logic changes, solo .env updates. Tested and working (2025-12-11 streaming implementation complete).",
      "code_changes_required": "Minimal: only .env URL updates for Phase 2/3, zero logic changes",
      "documentation": {
        "primary_source": "brain/prd_system.json (lines 235-355, tier_0_galleros_net_OPTION_FINAL_2025)",
        "technical_architecture": "brain/sdd_system.json (streaming_architecture section with live config details)",
        "api_endpoints": "brain/api_endpoints_reference.json (v2.5 with streaming endpoints)",
        "implementation": "brain/backlog.json (LIVE_STREAMING_IMPLEMENTATION_2025_12_11, NGINX_RTMP_CONFIG_PHASE_1_IMPLEMENTATION)"
      },
      "status": "IMPLEMENTED_PHASE_1_TESTING",
      "next_milestone": "Await MVP launch decision, then Phase 2 scaling triggers monitoring"
    },
    {
      "priority": "P1_PERFORMANCE_OPTIMIZATION_PLAN_READY",
      "task_description": "✅ Backend Performance Analysis Completed + Implementation Plan Created",
      "completion_date": "2025-11-21 (Plan), 2025-11-20 (Analysis)",
      "rationale": "QWEN completed comprehensive 4-phase SSE/WebSocket analysis. Director (Sonnet) validated findings and created implementation roadmap with 7 optimizations ranked by ROI.",
      "business_impact": "$40,800/year potential savings ($3,400/month). Phase 1 alone saves $2,900/month with 5-day break-even. Prevents exponential cloud costs at scale.",
      "technical_impact": "7 optimizations identified: connection limits (ROI 500), cache TTL (ROI 167), event history (ROI 133), adaptive heartbeat (ROI 60), message batching (ROI 67), pool monitoring (ROI 37.5), compression (ROI 18.75)",
      "implementation_plan": "qwen-optimization-plan.json",
      "source_file": "brain/backlog.json (BACKEND_PERFORMANCE_ANALYSIS_COMPLETED)",
      "next_steps": [
        "1. Review and approve qwen-optimization-plan.json",
        "2. Setup load testing environment (k6 or artillery)",
        "3. Run baseline test (25 concurrent users)",
        "4. Implement Phase 1 (Connection Limits + Cache TTL + Event History) - 10 hours",
        "5. Validate with load test (100 concurrent users)"
      ],
      "recommended_priority": "P1_HIGH - Implement Phase 1 immediately (5-day ROI break-even)"
    },
    {
      "priority": "P1",
      "task_description": "Implementar página de historial global de apuestas para Admin",
      "rationale": "La auditoría de funcionalidades de historial reveló que no existe una vista para que el admin supervise todas las apuestas, lo cual es un requisito de negocio para la operación.",
      "impact": "Baja visibilidad operativa y de negocio sobre la actividad de apuestas.",
      "source_file": "brain/backlog.json (recent_achievements_2025_11_07_auditoria_history_features)"
    },
    {
      "priority": "P2",
      "task_description": "Añadir funcionalidad de exportación a reportes de Admin",
      "rationale": "Los reportes financieros y de apuestas carecen de capacidad de exportación (CSV/PDF), limitando su utilidad para análisis externo.",
      "impact": "Dificulta el análisis de negocio y la contabilidad.",
      "source_file": "brain/backlog.json (recent_achievements_2025_11_07_auditoria_history_features)"
    }
  ],
  "decision_maker_priorities": [
    {
      "stakeholder": "Solo founder/developer (veranoby)",
      "concerns": [
        "Entrega del MVP en el plazo de 15 días.",
        "Resolución del rendimiento de la base de datos (CRÍTICO).",
        "Activación de la generación de ingresos (suscripciones).",
        "Funcionalidad completa del sistema de apuestas."
      ],
      "source_file": "brain/prd_system.json"
    }
  ],
  "implementation_roadmap": {
    "mvp_sprint_15_dias": [
      { "week": 1, "focus": "Implementación del núcleo (SSE, Frontend, Ventanas de Apuestas, Dashboard Operador)", "status": "Mayormente completado, con gaps de integración." },
      { "week": 2, "focus": "Optimización y Estabilización (Rendimiento BD, Pruebas, Pulido, Despliegue)", "status": "En progreso, rendimiento de BD resuelto, pero bloqueado por estabilidad de frontend." }
    ]
  },
  "success_gates": [
    {
      "phase": "Pre-Lanzamiento",
      "gate": "Validación E2E del Frontend exitosa.",
      "criteria": "Las 5 capas de la simulación E2E deben pasar al menos en un 80% para poder realizar la validación manual.",
      "status": "BLOQUEADO"
    },
    {
      "phase": "Lanzamiento MVP",
      "gate": "Despliegue en producción.",
      "criteria": "El sistema debe estar desplegado y funcional para el 21 de Septiembre.",
      "status": "EN RIESGO"
    },
    {
      "phase": "Post-Lanzamiento (Mes 1)",
      "gate": "Validación de negocio.",
      "criteria": "Alcanzar 25+ suscriptores y $500+ en ingresos.",
      "status": "PENDIENTE"
    }
  ],
  "cross_references_to_migrate": [
    {
      "informacion": "Métricas de éxito del negocio (25+ suscriptores, $500+ ingresos en Mes 1).",
      "ubicacion_original": "brain/prd_system.json",
      "destino_recomendado": "objectives_memory_index.json"
    }
  ],
  "boundaries_and_cross_references": {
    "ssot_declaration": "Este archivo es la SSOT para la lista priorizada de tareas y objetivos (P0-P3).",
    "references": "El progreso detallado de las tareas se reporta en `backlog.json`. Las métricas de éxito se definen en `objectives_memory_index.json`."
  }
}
{
  "business_context": {
    "company": "GalloBets",
    "product": "Plataforma de streaming profesional de peleas de gallos con apuestas P2P.",
    "mission": "Primera plataforma profesional de streaming + apuestas para galleras.",
    "timeline": "Sprint MVP de 15 días (7-21 de septiembre de 2025)",
    "revenue_model": [
      "Acceso a streaming basado en suscripción",
      "Tarifas de transacción en apuestas P2P (Post-MVP)",
      "Funciones premium para galleras/venues"
    ]
  },
  "stakeholders": {
    "primary_stakeholder": {
      "role": "Fundador/desarrollador único (veranoby)",
      "priorities": [
        "Entrega del MVP en 15 días",
        "Resolución del rendimiento de la base de datos",
        "Activación de la generación de ingresos",
        "Implementación del sistema de apuestas"
      ]
    },
    "user_segments": {
      "admins": {
        "capabilities": "Control total del sistema, todos los permisos",
        "needs": "Monitoreo en tiempo real, gestión de usuarios, análisis"
      },
      "operators": {
        "capabilities": "Herramientas de administración limitadas, gestión de eventos",
        "restrictions": "No pueden modificar usuarios administradores/operadores",
        "needs": "Gestión de eventos simplificada, controles de streaming"
      },
      "venues_galleras": {
        "capabilities": "Creación de eventos, gestión de perfiles, apuestas",
        "needs": "Configuración sencilla de streaming, seguimiento de ingresos"
      },
      "users": {
        "capabilities": "Ver transmisiones, realizar apuestas, gestionar billetera",
        "needs": "Transmisiones de calidad, apuestas fáciles, sistema justo"
      }
    }
  },
  "pain_points_prioritized": [
    {
      "pain_point": "Rendimiento de la base de datos (consultas de 1-3+ segundos)",
      "priority": "P0_CRITICAL",
      "impact": "Degradación de la experiencia del usuario, bloqueador para el lanzamiento.",
      "source_file": "brain/prd_system.json (risk_mitigation)"
    },
    {
      "pain_point": "Complejidad de integración de sistemas en tiempo real (SSE + WebSocket)",
      "priority": "P1",
      "impact": "Riesgo de errores, fugas de memoria y mantenimiento costoso.",
      "source_file": "brain/prd_system.json (risk_mitigation)"
    }
  ],
  "core_product_requirements": {
    "streaming_system": {
      "priority": "P0",
      "requirements": [
        "Ingesta de video vía RTMP desde OBS Studio.",
        "Entrega de video a espectadores vía HLS.",
        "Control de acceso basado en estado de suscripción del usuario."
      ]
    },
    "betting_system": {
      "priority": "P0",
      "requirements": [
        "Modelo de apuestas P2P (usuario contra usuario).",
        "Ventanas de apuestas temporales estrictas (solo se puede apostar en estado 'betting').",
        "Sistema de propuestas PAGO/DOY con timeout de 3 minutos vía WebSocket."
      ]
    },
    "subscription_system": {
      "priority": "P0",
      "requirements": [
        "Tiers: 24-horas ($5), mensual ($10), y gratis (por defecto/expirado).",
        "Flujo de solicitud de suscripción iniciado por el usuario con aprobación de admin.",
        "Expiración automática de suscripciones y revocación de acceso."
      ]
    },
    "user_workflows": {
      "event_creation": "Los Admins/Operadores pueden crear eventos y asignarlos a un 'venue' específico.",
      "betting": "Los usuarios pueden ver peleas, esperar la ventana de apuestas, y crear/aceptar apuestas P2P.",
      "operator": "Los operadores solo pueden gestionar los eventos que les son asignados y no pueden modificar otros admins/operadores."
    },
    "data_model_clarifications": {
      "events_and_venues": "Los eventos ocurren EN venues. `events.venue_id` apunta a un `user` con `role='venue'`.",
      "articles_and_authors": "Los artículos son escritos POR usuarios. `articles.author_id` apunta al creador. El campo `articles.venue_id` está obsoleto."
    }
  },
  "business_metrics": {
    "revenue_targets": {
      "month_1": { "subscribers": "25+", "revenue": "$500+" }
    },
    "platform_quality": [
      "99.5% de tiempo de actividad durante los eventos",
      "<500ms en consultas de base de datos",
      "<1s de latencia SSE"
    ]
  },

  "infrastructure_scaling_500_users": {
    "current_state": {
      "concurrent_users": "25-50",
      "monthly_cost": "$100-300 (VPS + Postgres + CDN)",
      "streaming_platform": "Nginx-RTMP (sufficient for current scale)"
    },
    "target_scale_500_concurrent_users": {
      "monthly_cost_range": "$2,100-5,300",
      "cost_drivers": [
        "CDN bandwidth: ~12 TB/hour for 500 viewers × 3 Mbps = 70-80% of costs",
        "Compute: API backend with SSE connection management = 10-15%",
        "Database: PostgreSQL with optimized pooling = 5-10%",
        "Monitoring: Real-time observability tools = 5%"
      ]
    },
    "infrastructure_tiers": {
      "tier_1_basic_$2100_3200_month": {
        "compute": "Vultr/Linode 4-core 8GB RAM = $24/month",
        "database": "Neon.tech PostgreSQL managed = $50-100/month",
        "streaming_ingest": "Ant Media Server open-source on VPS = $24/month",
        "cdn_distribution": "Bunny CDN HLS at $0.01/GB = $2,000-3,000/month",
        "monitoring": "Prometheus+Grafana self-hosted = $0-50/month",
        "suitable_for": "MVP testing, beta phase, low-revenue environments"
      },
      "tier_2_production_$3400_5300_month": {
        "compute": "Load-balanced (2× c6i.xlarge EC2) = $300-400/month",
        "database": "Neon.tech with read replicas = $200-300/month",
        "streaming": "Wowza Cloud professional = $400-600/month",
        "cdn_distribution": "Bunny CDN + DDoS protection = $2,000-3,000/month",
        "monitoring": "DataDog or New Relic = $500-1,000/month",
        "suitable_for": "Revenue-generating production platform"
      },
      "tier_3_optimized_$500_800_month": {
        "compute": "Vultr 4-core = $24/month",
        "database": "Neon.tech = $50/month",
        "streaming_origin": "Ant Media Server = $24/month",
        "cdn_bandwidth": "Bunny CDN with off-peak cutoff = $400-700/month",
        "suitable_for": "Regional galleras with scheduled events (peak hours only, no 24h streaming)"
      }
    },
    "cost_optimization_strategies": [
      "Bunny CDN is 5× cheaper than CloudFront ($0.01/GB vs $0.085/month for first 10 TB)",
      "Off-peak streaming reduces costs by 60% if events scheduled during specific hours",
      "Origin-shield technology reduces origin bandwidth by 30-50%",
      "Adaptive bitrate streaming (ABR) reduces per-user bandwidth by 20-30%",
      "Connection pooling with PgBouncer reduces database connection overhead"
    ],
    "critical_dependencies": [
      "Backend Performance Analysis (BACKEND_PERFORMANCE_ANALYSIS_PLAN) MUST complete before scaling to 500 users",
      "Memory leaks in SSE/WebSocket would cause exponential cost growth in production",
      "Database connection pooling MUST be optimized (currently max: 20, required: 100 for 500 users)"
    ]
  },
  "timeline_constraints": {
    "mvp_deadline": "21 de septiembre de 2025",
    "mvp_scope_included": [
      "Autenticación y roles",
      "Streaming RTMP/HLS",
      "Sistema de apuestas P2P básico",
      "Sistema de suscripción",
      "Dashboard de operador"
    ]
  },
  "cross_references_to_migrate": [
    {
      "informacion": "Detalles técnicos de la arquitectura (ej. estrategia SSE/WebSocket, ORM, etc.).",
      "ubicacion_original": "brain/prd_system.json (core_features.technical_architecture)",
      "destino_recomendado": "sdd_system.json"
    }
  ],
  "boundaries_and_cross_references": {
    "ssot_declaration": "Este archivo es la SSOT para los requisitos del producto, stakeholders y lógica de negocio.",
    "references": "Las decisiones de solución técnica detalladas se definen en `sdd_system.json`. Los objetivos de alto nivel se definen en `objectives_memory_index.json`."
  }
}
{
  "metadata": {
    "purpose": "Product requirements and business context for GalloBets platform",
    "updated": "2025-09-21",
    "version": "2.0",
    "cross_references": ["sdd_system.json", "multi_ai_coordination_strategy.json", "backlog.json"]
  },
  
  "business_context": {
    "company": "GalloBets",
    "product": "Professional cockfighting streaming platform with P2P betting",
    "mission": "First professional streaming + betting platform for galleras",
    "timeline": "15-day MVP sprint (September 7-21, 2025)",
    "revenue_model": [
      "Subscription-based streaming access",
      "Transaction fees on P2P betting (Post-MVP)",
      "Premium features for galleras/venues"
    ]
  },
  
  "stakeholders": {
    "primary_stakeholder": {
      "role": "Solo founder/developer (veranoby)",
      "priorities": [
        "15-day MVP delivery",
        "Database performance resolution",
        "Revenue generation activation",
        "Betting system implementation"
      ],
      "success_metrics": [
        "Platform launched by September 21",
        "First paying subscribers active",
        "Betting system functional",
        "Operator dashboard working"
      ]
    },
    
    "user_segments": {
      "admins": {
        "capabilities": "Full system control, all permissions",
        "needs": "Real-time monitoring, user management, analytics",
        "interface": "Complete admin dashboard with SSE updates"
      },
      "operators": {
        "capabilities": "Limited admin tools, event management",
        "restrictions": "Cannot modify admin/operator users",
        "needs": "Streamlined event management, streaming controls",
        "interface": "Restricted admin environment"
      },
      "venues_galleras": {
        "capabilities": "Event creation, profile management, betting",
        "needs": "Easy streaming setup, revenue tracking",
        "revenue_share": "Percentage of subscriptions from their events"
      },
      "users": {
        "capabilities": "View streams, place bets, manage wallet",
        "needs": "Quality streams, easy betting, fair system",
        "payment_methods": "Kushki for subscriptions and wallet"
      }
    }
  },
  
  "core_features": {
    "streaming_system": {
      "priority": "P0",
      "status": "70% complete",
      "components": {
        "rtmp_ingestion": "OBS Studio → RTMP server",
        "stream_delivery": "HLS output for viewers",
        "access_control": "Subscription validation",
        "monitoring": "Real-time viewer analytics"
      },
      "success_metrics": [
        "99.5% uptime during events",
        "<3 second latency",
        "Support 25+ concurrent viewers (MVP)",
        "Support 100+ concurrent viewers (Year 1)"
      ]
    },
    
    "betting_system": {
      "priority": "P0",
      "status": "Architecture defined",
      "core_concepts": {
        "p2p_model": "Users bet against each other, not the house",
        "bet_types": ["PAGO (bet on winner)", "DOY (bet on time/rounds)"],
        "temporal_windows": "Bets ONLY during 'betting' status",
        "pago_doy_proposals": "Counter-proposals with 3-min timeout"
      },
      "technical_architecture": {
        "real_time_updates": "SSE for bet list updates",
        "proposal_system": "WebSocket MINIMAL for PAGO/DOY only",
        "wallet_operations": "Manual refresh, no WebSocket",
        "fight_transitions": "upcoming → betting → live → completed"
      },
      "business_rules": [
        "Betting window closes when fight goes live",
        "No bets accepted during live fight",
        "PAGO proposals timeout after 3 minutes",
        "Platform takes % commission on winnings"
      ]
    },
    
    "subscription_system": {
      "priority": "P0",
      "status": "Implemented",
      "payment_provider": "Kushki",
      "tiers": {
        "24-hour": "$5",
        "monthly": "$10",
        "free": "$0 (default when expired/cancelled)"
      },
      "features": [
        "24-hour pass for daily access",
        "Monthly subscription with optional auto-renewal",
        "Free tier reverts automatically on expiration",
        "Multiple payment methods via Kushki",
        "Access validation for streams"
      ]
    },
    
    "real_time_architecture": {
      "priority": "P0",
      "status": "In development",
      "strategy": "Hybrid SSE + Minimal WebSocket",
      "sse_usage": [
        "Admin dashboard real-time updates",
        "System monitoring and alerts",
        "Betting list updates",
        "Fight status changes",
        "Operator notifications"
      ],
      "websocket_usage": [
        "PAGO/DOY proposals ONLY",
        "3-minute bidirectional timeout",
        "No wallet operations",
        "No dynamic suggestions",
        "No chat functionality"
      ],
      "rationale": [
        "SSE simpler for one-way updates",
        "WebSocket only where bidirectional required",
        "Reduces complexity and memory leaks",
        "Easier debugging and maintenance"
      ]
    }
  },
  
  "user_workflows": {
    "event_creation_workflow": {
      "actors": ["Admin", "Operator", "Venue"],
      "steps": [
        "Create event with date/time",
        "Assign operator (if admin creating)",
        "Generate stream key",
        "Configure OBS with stream key",
        "Create fights within event"
      ]
    },
    
    "betting_workflow": {
      "actors": ["User"],
      "steps": [
        "View upcoming fight",
        "Wait for betting window to open",
        "Create bet or accept existing",
        "PAGO/DOY proposal if desired",
        "Window closes when fight goes live",
        "Watch fight outcome",
        "Winnings distributed automatically"
      ]
    },
    
    "operator_workflow": {
      "actors": ["Operator"],
      "steps": [
        "Access assigned events only",
        "Manage fight transitions",
        "Open/close betting windows",
        "Monitor streaming status",
        "Cannot modify admin users"
      ]
    }
  },
  
  "business_validation": {
    "revenue_targets": {
      "month_1": {
        "subscribers": "25+",
        "revenue": "$500+",
        "events_per_week": "1-2"
      },
      "month_3": {
        "subscribers": "100+",
        "revenue": "$2000+",
        "events_per_week": "5-7",
        "betting_volume": "$10,000+"
      },
      "year_1": {
        "subscribers": "1000+",
        "revenue": "$20,000/month",
        "betting_commission": "$5,000/month"
      }
    },
    
    "success_metrics": {
      "user_acquisition": [
        "25 subscribers in first month",
        "70% renewal rate",
        "15+ minute average session"
      ],
      "platform_quality": [
        "99.5% uptime during events",
        "<500ms database queries",
        "<1s SSE latency",
        "Zero authentication issues"
      ],
      "business_operations": [
        "Operators managing 80% of events",
        "90% successful payment processing",
        "95% user satisfaction rate"
      ]
    }
  },
  
  "technical_requirements": {
    "performance": {
      "database_queries": "<500ms for 95% of queries",
      "api_response": "<200ms average",
      "sse_latency": "<1 second",
      "page_load": "<2 seconds",
      "stream_latency": "<3 seconds"
    },
    
    "scalability": {
      "concurrent_users": "25+ (MVP), 100+ (Month 3), 1000+ (Year 1)",
      "concurrent_streams": "1 (MVP), 3+ (Month 3), 10+ (Year 1)",
      "database_connections": "Optimized pool management",
      "real_time_connections": "SSE + minimal WebSocket"
    },
    
    "security": {
      "authentication": "JWT with role-based claims",
      "payment_security": "Kushki PCI compliance",
      "stream_access": "Subscription validation",
      "betting_integrity": "Temporal window enforcement"
    }
  },
  
  "risk_mitigation": {
    "technical_risks": {
      "database_performance": {
        "current_state": "1-3+ second queries",
        "mitigation": "Day 8-10 dedicated optimization",
        "owner": "Claude"
      },
      "qwen_destruction": {
        "evidence": "Broke Profile.tsx and auth",
        "mitigation": "FORBIDDEN files list, git backups",
        "owner": "All AIs aware"
      },
      "integration_complexity": {
        "concern": "SSE + WebSocket coordination",
        "mitigation": "Clear separation of concerns",
        "owner": "Claude architecture"
      }
    },
    
    "business_risks": {
      "user_adoption": {
        "concern": "New platform in traditional market",
        "mitigation": "Partner with established galleras",
        "strategy": "Quality + reliability differentiation"
      },
      "regulatory": {
        "concern": "Gambling regulations",
        "mitigation": "P2P model, not house betting",
        "compliance": "Age verification, geo-restrictions"
      }
    }
  },
  
  "mvp_scope": {
    "included": [
      "User authentication and roles",
      "SSE real-time for admin",
      "Minimal WebSocket for PAGO/DOY",
      "Fight temporal betting windows",
      "Operator dashboard with restrictions",
      "RTMP streaming integration",
      "Kushki payment processing",
      "Basic betting system"
    ],
    
    "excluded_post_mvp": [
      "Advanced analytics",
      "Mobile applications",
      "Multiple language support",
      "Advanced betting features",
      "Social features",
      "Detailed reporting"
    ]
  },
  
  "success_criteria": {
    "mvp_launch": [
      "System deployed by September 21",
      "All P0 features functional",
      "Database queries <500ms",
      "First event streamed successfully"
    ],
    
    "week_1_post_launch": [
      "10+ active subscribers",
      "Zero critical bugs",
      "Successful betting on fights",
      "Operator managing events"
    ],
    
    "month_1_validation": [
      "25+ paying subscribers",
      "5+ events completed",
      "$500+ revenue generated",
      "Platform stability proven"
    ]
  }
}
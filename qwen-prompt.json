{
  "üî¥_SESSION_START_PROTOCOL": {
    "executor_model": "qwen3-coder-plus-2025-09-23",
    "role": "executor",
    "execution_mode": "standard",
    "session_declaration": "Output at start: 'Model: qwen3-coder-plus-2025-09-23 | Role: executor | Mode: standard | Task: Implement Nginx RTMP + PostgreSQL local (OPTION B.1)'",
    "task_echo_back": "MANDATORY - Read entire PLAN section, echo back 3 tasks in order (TASK_1 ‚Üí TASK_2 ‚Üí TASK_3), confirm understanding before coding"
  },

  "üî¥_DIRECTOR_PLANNING_PROTOCOL_REFERENCE": {
    "protocol_file": "brain/multi_ai_coordination_strategy.json lines 79-100",
    "critical_rules_applied": [
      "Line 82: Plan created by director AFTER reading coordination strategy",
      "Line 92-98: Plan includes all mandatory elements for executor",
      "Reference: OPTION B.1 defined in brain/prd_system.json lines 119-170 and brain/sdd_system.json lines 75-112"
    ]
  },

  "task": "Backend configuration for OPTION B.1: Nginx RTMP + PostgreSQL local + Bunny CDN readiness",
  "business_impact": "Enable GalloBets to use open-source Nginx RTMP streaming ($155-195/mo vs $1,400+ managed), with PostgreSQL local maintenance (30 min/week), and seamless CDN integration when scaling",
  "priority": "CRITICAL_PHASE_1",
  "executor": "qwen3-coder-plus-2025-09-23",
  "constraints": {
    "keep_all_functionality": "MANDATORY - NO feature removal, streaming logic unchanged",
    "no_breaking_changes": true,
    "scope": "Config + documentation only (0 logic changes)",
    "session_management": {
      "time_limit": "60 minutes max",
      "checkpoint_frequency": "After each task completion",
      "context_loss_handling": "If token budget exceeded, save state to qwen-checkpoint.json"
    }
  },

  "implementation_tasks": [
    {
      "id": "TASK_1_BACKEND_ENV_CONFIG",
      "order": 1,
      "title": "Update backend .env for Nginx RTMP (Phase 1: Local HLS)",
      "files_to_modify": [
        {
          "file": "backend/.env",
          "action": "UPDATE",
          "changes": [
            "STREAM_SERVER_URL: Update placeholder 'your-nginx-server.com' ‚Üí actual Nginx RTMP server address",
            "CDN_URL: Set to Nginx server address (Phase 1, no Bunny CDN yet)",
            "STREAM_HEALTH_CHECK_URL: Set to Nginx health check endpoint"
          ],
          "note": "Project uses .env directly (not .env.production). Update existing placeholders with real server addresses."
        }
      ],
      "validation_gates": [
        "STREAM_SERVER_URL points to Nginx RTMP server",
        "CDN_URL points to Nginx server (not Bunny, Phase 1)",
        "No TypeScript errors"
      ]
    },

    {
      "id": "TASK_2_FRONTEND_ENV_CONFIG",
      "order": 2,
      "title": "Update frontend .env for Nginx HLS (Phase 1 + Phase 2 template)",
      "files_to_modify": [
        {
          "file": "frontend/.env",
          "action": "UPDATE",
          "changes": [
            "VITE_STREAM_BASE_URL: Update placeholder 'your-nginx-server.com' ‚Üí actual Nginx HLS server address (http://SERVER_IP/hls or http://DOMAIN/hls)"
          ],
          "note": "Project uses .env directly. Add comment for Phase 2 CDN migration path."
        },
        {
          "file": "frontend/src/components/streaming/HLSPlayer.tsx",
          "action": "VERIFY_ONLY",
          "check": "HLS URL uses VITE_STREAM_BASE_URL from environment (code already correct)"
        }
      ],
      "validation_gates": [
        "VITE_STREAM_BASE_URL environment variable defined",
        "npm run build succeeds",
        "HLS URL construction uses env variable (ready for CDN switch)"
      ]
    },

    {
      "id": "TASK_3_REFERENCE_DOCUMENTATION_UPDATES",
      "order": 3,
      "title": "Update metadata in api/typescript reference files for OPTION B.1",
      "files_to_modify": [
        {
          "file": "brain/api_endpoints_reference.json",
          "action": "UPDATE_METADATA_ONLY",
          "location": "metadata section at top",
          "changes": [
            "Add line to metadata: 'streaming_platform_selected': 'Nginx RTMP (self-managed) + PostgreSQL local (OPTION B.1 selected 2025-11-20)'",
            "Add line: 'environment_variables_required': ['STREAM_SERVER_URL=rtmp://nginx-server:1935/live', 'CDN_URL=http://nginx-server', 'STREAM_HEALTH_CHECK_URL=http://nginx-server']",
            "Add line: 'phase_2_bunny_cdn': 'When scaling >500 concurrent, add Bunny CDN (config-only change, no endpoint changes)'"
          ],
          "note": "Only metadata, DO NOT change endpoint documentation"
        },
        {
          "file": "brain/typescript_interfaces_reference.json",
          "action": "UPDATE_METADATA_ONLY",
          "location": "Add new section at top after opening brace",
          "changes": [
            "Add metadata: 'streaming_infrastructure': 'Nginx RTMP (self-managed) + PostgreSQL local (OPTION B.1)'",
            "Add metadata: 'required_environment_variables': { 'STREAM_SERVER_URL': 'rtmp://nginx-server:1935/live', 'CDN_URL': 'http://nginx-server (Phase 1) or https://bunny-cdn (Phase 2)', 'STREAM_HEALTH_CHECK_URL': 'http://nginx-server' }"
          ],
          "note": "Only metadata, DO NOT change interface documentation"
        }
      ],
      "validation_gates": [
        "api_endpoints_reference.json metadata includes Nginx RTMP + environment variables",
        "typescript_interfaces_reference.json metadata includes streaming infrastructure notes",
        "No endpoint or interface definitions were changed (metadata-only update)"
      ]
    }
  ],

  "validation_gates_critical": [
    "npx tsc --noEmit: ZERO TypeScript errors",
    "npm run build succeeds",
    "STREAM_SERVER_URL + CDN_URL point to Nginx (not localhost or Bunny Phase 1)",
    "HLS URL construction uses environment variable",
    "Brain files consistent with prd_system.json OPTION B.1"
  ],

  "reporting_location": {
    "completion_report_file": "brain/backlog.json (project root/brain/)",
    "report_entry_format": {
      "structure": "Add new object under 'completed_tasks' array with the following fields:",
      "task_id": "NGINX_RTMP_CONFIG_PHASE_1_IMPLEMENTATION",
      "status": "COMPLETED",
      "completion_date": "2025-11-20",
      "complexity": "LOW",
      "category": "INFRASTRUCTURE_CONFIGURATION",
      "priority": "CRITICAL",
      "executor": "qwen3-coder-plus-2025-09-23",
      "summary": "Configuration setup for OPTION B.1: Nginx RTMP + PostgreSQL local streaming architecture",
      "changes_implemented": [
        "‚úÖ TASK_1: Updated backend/.env.production: STREAM_SERVER_URL ‚Üí nginx-server | CDN_URL ‚Üí nginx-server | STREAM_HEALTH_CHECK_URL ‚Üí nginx-server",
        "‚úÖ TASK_2: Updated frontend/.env.production: VITE_STREAM_BASE_URL ‚Üí http://nginx-server/hls (Phase 1 template + Phase 2 CDN comment)",
        "‚úÖ TASK_3: Updated brain/api_endpoints_reference.json metadata: Added streaming_platform_selected, environment_variables_required, phase_2_bunny_cdn notes",
        "‚úÖ TASK_3: Updated brain/typescript_interfaces_reference.json metadata: Added streaming_infrastructure, required_environment_variables sections"
      ],
      "validation_results": {
        "typescript_check": "Command: npx tsc --noEmit | Result: [output]",
        "build_check": "Command: npm run build | Result: [success/failure]",
        "env_verification": "Backend .env points to Nginx RTMP (not localhost or Bunny Phase 1)",
        "code_ready_for_cdn": "HLS URL construction uses VITE_STREAM_BASE_URL environment variable (zero code changes needed for Phase 2 CDN switch)"
      },
      "business_impact": "OPTION B.1 configured: $155-195/mo (Dedicated Server + Nginx RTMP + PostgreSQL local). Supports 500 concurrent, scales to 800 with Bunny CDN addition ($263-411/mo). Saves $450 vs Option B.2 in first 6 months if gradual growth.",
      "total_time_spent": "[Actual execution time in minutes]"
    }
  },

  "critical_do_not_do": [
    "‚ùå Do NOT change streaming logic or endpoints",
    "‚ùå Do NOT hardcode URLs (use environment variables)",
    "‚ùå Do NOT modify database schema",
    "‚ùå Do NOT implement Phase 2 CDN (config template only)"
  ],

  "success_criteria": [
    "‚úì 3 tasks completed (TASK_1 ‚Üí TASK_2 ‚Üí TASK_3)",
    "‚úì Backend .env configured for Nginx RTMP",
    "‚úì Frontend .env configured for Nginx HLS",
    "‚úì npx tsc --noEmit passes",
    "‚úì npm run build succeeds",
    "‚úì Brain files updated",
    "‚úì Total time ‚â§ 60 minutes"
  ]
}

{
  "metadata": {
    "task_name": "Fix and Optimize Admin Articles Management",
    "complexity": "MEDIUM",
    "execution_mode": "standard",
    "assigned_role": "executor",
    "model_preference": "qwen3-coder-plus-2025-09-23",
    "git_branch": "feature/articles-fix"
  },
  "critical_protocols": {
    "comment": "Executor AI must adhere to these protocols from brain/multi_ai_coordination_strategy.json",
    "protocols_to_follow": [
      "ðŸ”´_AUDIT_AND_ANALYSIS_METHODOLOGY_PROTOCOL (lines 147-281)",
      "ðŸ”´_UI_VERIFICATION_PROTOCOL (lines 283-396)",
      "ðŸ”´_SOURCE_VERIFICATION_BEFORE_USAGE_PROTOCOL (lines 401-515)",
      "simulate_y_confirmar_protocol (lines 467-476)",
      "ðŸ”´_IMPLEMENTATION_AND_REPORTING_OPTIMIZATION_FRAMEWORK_2025_11_27 (lines 953-1225)"
    ]
  },
  "reference_files_to_read_first": [
    "/home/veranoby/sports-bets/frontend/src/pages/admin/Articles.tsx",
    "/home/veranoby/sports-bets/brain/api_endpoints_reference.json",
    "/home/veranoby/sports-bets/brain/multi_ai_coordination_strategy.json"
  ],
  "analysis_summary": {
    "initial_request": "1) Translate action buttons in Articles.tsx to Spanish. 2) Simulate actions and identify problems, specifically the non-functional 'delete' button. 3) Verify against documentation.",
    "findings": [
      {
        "area": "Frontend UI",
        "description": "Action buttons (Preview, Edit, Delete, etc.) were in English. This has been addressed by translating them to Spanish (Visualizar, Editar, Eliminar, etc.).",
        "status": "COMPLETED_BY_DIRECTOR_AI"
      },
      {
        "area": "Backend API",
        "description": "The 'Delete' button functionality is broken. The simulation and user-provided logs confirm a '404 Not Found' error for the request 'DELETE /api/articles/:id'.",
        "root_cause": "The backend has not implemented the documented DELETE /articles/:id endpoint as specified in brain/api_endpoints_reference.json. This is an implementation gap, not a design flaw.",
        "status": "NEEDS_IMPLEMENTATION"
      },
      {
        "area": "Frontend UX",
        "description": "The delete confirmation uses a native 'window.confirm()' dialog, which is inconsistent with the custom modals used for other actions like 'Reject'.",
        "recommendation": "Replace the native confirm dialog with a custom modal for a more consistent and professional user experience.",
        "status": "RECOMMENDED_IMPROVEMENT"
      }
    ]
  },
  "step_by_step_implementation_plan": {
    "phase_1_backend_api_fix": {
      "objective": "Implement the documented DELETE /api/articles/:id endpoint to align the backend with the API specification.",
      "step_1_locate_route_file": {
        "action": "Find the correct file for article routes. Based on project structure, this is likely 'backend/src/routes/articles.ts'. Verify this path.",
        "validate": "Confirm the file contains other article-related routes (e.g., GET, POST, PATCH)."
      },
      "step_2_implement_delete_route": {
        "action": "In the articles route file, add a new route handler for DELETE requests, as documented in 'brain/api_endpoints_reference.json'.",
        "code_suggestion": {
          "file": "backend/src/routes/articles.ts",
          "language": "typescript",
          "snippet": "router.delete('/articles/:id', authMiddleware, checkRole(['admin', 'gallera', 'venue']), articlesController.deleteArticle);"
        },
        "notes": "Ensure 'authMiddleware' and 'checkRole' are used to restrict this action as per the documentation. The controller function 'articlesController.deleteArticle' will likely need to be created."
      },
      "step_3_implement_controller_logic": {
        "action": "In the corresponding controller file (likely 'backend/src/controllers/articlesController.ts'), create the 'deleteArticle' function.",
        "code_suggestion": {
          "file": "backend/src/controllers/articlesController.ts",
          "language": "typescript",
          "snippet": "async deleteArticle(req: Request, res: Response) {\n  const { id } = req.params;\n  try {\n    // Note: Add ownership check logic here as per documentation\n    const result = await articleService.delete(id, req.user);\n    if (result.success) {\n      return res.status(204).send();\n    } else {\n      return res.status(404).json({ error: result.error });\n    }\n  } catch (error) {\n    return res.status(500).json({ error: 'Internal server error' });\n  }\n}"
        },
        "notes": "This function should parse the ID from request params and call a service-layer function. Crucially, it must also enforce the ownership rule specified in the documentation ('Only admin or article owner can delete')."
      },
      "step_4_implement_service_logic": {
        "action": "In the article service file (e.g., 'backend/src/services/articleService.ts'), implement the deletion logic. It must include an ownership check.",
        "notes": "The logic should be: 1. Find the article by ID. 2. If not found, return error. 3. If user is not admin, check if 'article.author_id === user.id'. If not, return an authorization error. 4. If checks pass, delete the article using the ORM (e.g., 'Article.destroy({ where: { id } })')."
      },
      "validate": "After implementation, run 'npx tsc --noEmit' in the 'backend/' directory. Manually test the endpoint using a tool like 'curl' or Postman to confirm a '204 No Content' response on successful deletion, '404 Not Found' for an invalid ID, and '403 Forbidden' when a non-owner/non-admin tries to delete."
    },
    "phase_2_frontend_ux_improvement": {
      "objective": "Enhance the delete confirmation experience to be consistent with the application's UI.",
      "step_1_create_confirmation_modal_state": {
        "action": "In 'frontend/src/pages/admin/Articles.tsx', add state to manage the delete confirmation modal.",
        "code_suggestion": {
          "file": "frontend/src/pages/admin/Articles.tsx",
          "language": "typescript",
          "snippet": "const [showDeleteModal, setShowDeleteModal] = useState(false);\nconst [deletingArticleId, setDeletingArticleId] = useState<string | null>(null);"
        }
      },
      "step_2_modify_delete_handler": {
        "action": "Update the button's 'onClick' to open the modal instead of calling 'handleDeleteArticle' directly.",
        "code_suggestion": {
          "file": "frontend/src/pages/admin/Articles.tsx",
          "snippet": "const openDeleteModal = (articleId: string) => {\n  setDeletingArticleId(articleId);\n  setShowDeleteModal(true);\n};\n\n// The button should now call openDeleteModal(article.id)"
        },
        "notes": "The existing 'handleDeleteArticle' logic should be moved to a new function, e.g., 'confirmDeleteArticle', which will be called by the modal's confirm button."
      },
      "step_3_implement_confirmation_modal_jsx": {
        "action": "Add the JSX for the delete confirmation modal, using the existing 'showRejectModal' as a template for style consistency.",
        "notes": "The modal should clearly state the irreversible nature of the action and have 'Confirmar EliminaciÃ³n' and 'Cancelar' buttons."
      },
      "validate": "Run 'npx tsc --noEmit' in the 'frontend/' directory. Start the dev server and verify that clicking the 'Eliminar' button now opens a custom modal."
    }
  },
  "success_criteria": [
    "Backend successfully handles 'DELETE /api/articles/:id' requests with proper authentication and ownership checks.",
    "Frontend UI buttons in 'Articles.tsx' are fully translated to Spanish (This is already done).",
    "Clicking the 'Eliminar' button on an article opens a custom confirmation modal.",
    "Confirming deletion in the modal successfully removes the article and updates the list.",
    "All code passes TypeScript checks ('npx tsc --noEmit') in both 'frontend' and 'backend' directories.",
    "The implementation is consistent with the definitions in 'brain/api_endpoints_reference.json' and 'brain/typescript_interfaces_reference.json'."
  ],
  "error_handling_plan": {
    "typescript_errors": "Do not proceed if 'npx tsc --noEmit' fails. Analyze the errors and fix them before continuing implementation.",
    "api_errors": "If the backend fix does not work as expected, log all relevant variables (request params, user role, database query) to debug the flow from route to service."
  }
}
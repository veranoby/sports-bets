{
  "task_description": "Execute a validated, multi-phase optimization of the admin events page (/admin/events), focusing on bug fixes, UI enhancements, and a major architectural refactoring.",
  "analysis_of_causes": [
    {
      "issue": "Incorrect 'Today's Events' List",
      "root_cause": "The 'todayEvents' list is derived client-side from the main `events` state array. This array is filtered by the backend, meaning it doesn't always contain all of today's events, leading to an incomplete UI section.",
      "validated": true
    },
    {
      "issue": "Mismatched 'Delete' Button Functionality",
      "root_cause": "The UI label implies permanent deletion, but the `DELETE /api/events/:id` endpoint only performs a soft delete (sets status to 'cancelled'). This is a UX and functional discrepancy.",
      "validated": true
    },
    {
      "issue": "API Inconsistency for 'Cancel' Action",
      "root_cause": "The frontend client (`eventsAPI.cancel`) attempts to call a non-existent `POST /events/:id/cancel` endpoint. The correct, existing endpoint is `PATCH /api/events/:id/status` with an action payload of 'cancel'.",
      "validated": true
    },
    {
      "issue": "Monolithic 'God Component' Architecture",
      "root_cause": "`Events.tsx` manages state and logic for both the event list and the detailed event view, creating high complexity, tight coupling, and difficult maintenance.",
      "validated": true
    },
    {
      "issue": "UI/UX Redesign Required for Event Detail View",
      "root_cause": "The current layout with a sidebar and tabs is inefficient. A new design is required to improve workflow, collocating related controls and information.",
      "validated": true
    }
  ],
  "proposed_solutions": [
    {
      "phase": "Phase 1: Critical Bug Fixes and Foundational Work",
      "solutions": [
        {
          "solution": "Fix API inconsistency for the event cancellation action.",
          "priority": "CRITICAL",
          "implementation_steps": [
            "In `frontend/src/config/api.ts`, remove the incorrect `eventsAPI.cancel` method.",
            "In `frontend/src/pages/admin/Events.tsx`, ensure the `handleEventAction` function's 'cancel' case correctly calls the `PATCH /api/events/:id/status` endpoint. This may already be in place, but must be verified.",
            "Update the 'Cancelar Evento' button in the detail view header to call `handleEventAction(eventId, 'cancel')`."
          ],
          "files": ["frontend/src/config/api.ts", "frontend/src/pages/admin/Events.tsx"]
        },
        {
          "solution": "Correct the 'Delete' button's text to match its soft-delete functionality.",
          "priority": "HIGH",
          "implementation_steps": [
            "In `frontend/src/pages/admin/Events.tsx`, locate the two `Trash2` delete buttons.",
            "Change the `title` and tooltip text from 'Eliminar Evento' and 'Eliminar este evento permanentemente' to 'Cancelar Evento'."
          ],
          "validation_steps": ["Confirm the button's hover text now accurately reflects the cancel action."],
          "files": ["frontend/src/pages/admin/Events.tsx"]
        },
        {
          "solution": "Isolate the data fetch for the 'Today's Events' section.",
          "priority": "MEDIUM",
          "implementation_steps": [
            "In `Events.tsx`, create a new state: `const [todayEvents, setTodayEvents] = useState<Event[]>([]);`.",
            "Create a new `useCallback` function `fetchTodayEvents` that calls `eventsAPI.getAll({ dateRange: 'today' })`.",
            "Call this function in a `useEffect` hook that runs once on component mount.",
            "Ensure the 'Eventos de Hoy' JSX section maps over this new `todayEvents` state."
          ],
          "validation_steps": ["Apply filters to the main event list and confirm the 'Today's Events' section does not change."],
          "files": ["frontend/src/pages/admin/Events.tsx"]
        }
      ]
    },
    {
      "phase": "Phase 2: UI/UX Redesign and Component Refactoring",
      "solutions": [
        {
          "solution": "Implement an interactive status-change dropdown menu.",
          "priority": "MEDIUM",
           "pre-computation_steps": [
            "Read `backend/src/routes/events.ts` to map the `switch (action)` block inside `PATCH /api/events/:id/status` to determine valid state transitions."
            ],
          "implementation_steps": [
            "Create a new component `StatusChanger.tsx` that receives the `event` object.",
            "The component will render the current status badge. When clicked, it will display a dropdown menu.",
            "The menu options will be dynamically generated based on the allowed transitions for the event's current status (e.g., a 'scheduled' event shows 'Activate' and 'Cancel').",
            "Selecting an option will trigger a handler prop (e.g., `onStatusChange`) that calls the appropriate `handleEventAction` in the parent component."
          ],
          "files": ["frontend/src/pages/admin/Events.tsx", "frontend/src/components/admin/StatusChanger.tsx (new file)"]
        },
        {
          "solution": "Decompose `Events.tsx` into a modular, routed structure.",
          "priority": "HIGH",
          "implementation_steps": [
            "Rename `Events.tsx` to `EventsPage.tsx` to act as the main container/router.",
            "Create `components/admin/events/EventList.tsx` and migrate the event list rendering and logic into it.",
            "Create `components/admin/events/EventDetail.tsx` to house the new detail view design.",
            "In `EventsPage.tsx`, use `useParams` to conditionally render `EventList` or `EventDetail`."
          ],
          "files": ["frontend/src/pages/admin/Events.tsx", "frontend/src/components/admin/events/EventList.tsx (new)", "frontend/src/components/admin/events/EventDetail.tsx (new)"]
        },
        {
          "solution": "Implement the new 3-row, 2-column detail view layout in `EventDetail.tsx`.",
          "priority": "HIGH",
          "implementation_steps": [
            "**Row 1 (Header):** Arrange the back button, event title, the new `StatusChanger` component, operator name, and action buttons.",
            "**Row 2 (Streaming):** Consolidate all streaming-related UI and logic (status, controls, viewer count). Lift the `useMultiSSE` hook logic to `EventDetail.tsx` to maintain a stable connection. Integrate an existing video player component for the preview.",
            "**Row 3 (Fights & Bets):** Use a two-column grid. Migrate the fight management UI to the left column and the active bets UI to the right column."
          ],
          "files": ["frontend/src/components/admin/events/EventDetail.tsx"]
        },
        {
          "solution": "Implement the interactive link between the fights list and the bets list.",
          "priority": "HIGH",
          "implementation_steps": [
            "In `EventDetail.tsx`, manage a `selectedFightId` state, updated via `onClick` handlers on the fight list items.",
            "Pass `selectedFightId` as a prop to the bets component.",
            "The bets component will use a `useEffect` hook to re-fetch bets from `betsAPI.getAllAdmin({ fightId: selectedFightId })` whenever the prop changes."
          ],
          "files": ["frontend/src/components/admin/events/EventDetail.tsx", "frontend/src/components/admin/BetsActiveTab.tsx (or its successor)"]
        }
      ]
    }
  ],
  "validation_and_reporting": {
    "verification_steps": [
      "Confirm API calls use correct endpoints as per documentation.",
      "Verify UI text matches backend functionality (e.g., 'Cancel' vs 'Delete').",
      "Test all new interactive UI elements (status dropdown, fight selection).",
      "Ensure the refactored component architecture is clean and state management is correct.",
      "Run `npx tsc --noEmit -p backend/tsconfig.json` for backend changes. For the frontend, run `npm run build` from the `frontend` directory to ensure type validation and a successful build. Run `eslint` to ensure code quality."
    ],
    "final_report": "Update `brain/backlog.json` with a detailed entry for each phase, including git commit hashes, verification evidence (`npx tsc --noEmit` results), and a summary of the architectural improvements."
  },
  "critical_protocols_to_follow": [
    "Adherence to `brain/multi_ai_coordination_strategy.json` is mandatory.",
    "**SOURCE_VERIFICATION_BEFORE_USAGE_PROTOCOL:** All API calls must be verified against `@brain/api_endpoints_reference.json` and all props/types against `@brain/typescript_interfaces_reference.json` before implementation.",
    "**UI_VERIFICATION_PROTOCOL:** All UI component assumptions must be verified by reading the source TSX files before use.",
    "All backend code changes must pass `npx tsc --noEmit -p backend/tsconfig.json`. For the frontend, rely on the integrated build script (`npm run build` within the `frontend` directory) for type validation, as requested."
  ]
}

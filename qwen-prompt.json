{
  "=4_COORDINATOR_STRATEGY_COMPLIANCE": {
    "director_ai": "Claude Sonnet 4.5 - Created following DIRECTOR_PLANNING_PROTOCOL",
    "executor_ai": "Qwen - Execute following ALL mandatory protocols"
  },

  "task_metadata": {
    "task_name": "Code Quality Refactoring + Backend Code Cleanup",
    "complexity": "MEDIUM",
    "execution_mode": "standard",
    "assigned_role": "executor",
    "estimated_duration_minutes": "75 (Session 1: Refactor bets.ts 60min + Session 2: Code cleanup 15min)",
    "git_branch": "main",
    "mcp_activation_required": ["--seq", "--sequential"],
    "checkpoint_frequency": "Every 15 minutes"
  },

  "=4_SESSION_START_DECLARATION": {
    "must_declare": "Model: qwen3-coder-plus | Role: executor | Mode: standard | Task: Refactor + Code Cleanup | Flags: --seq ACTIVATED",
    "must_echo_back": "Session 1: Refactor bets.ts service layer (60min). Session 2: Cleanup articles.venue_id code (15min). Confirm Y/N?",
    "validation": "npx tsc --noEmit && npm run build && git diff --name-only"
  },

  "=4_CRITICAL_PREREQUISITES": {
    "mandatory_reads": [
      "brain/multi_ai_coordination_strategy.json",
      "backend/src/routes/bets.ts (UNDERSTAND COMPLETELY - 1270 lines)"
    ]
  },

  "problems_to_solve": {
    "problem_1_refactor_bets_service_layer": {
      "priority": "P2_MEDIUM",
      "description": "Extract business logic from bets.ts (1270 lines) into betService.ts for better maintainability",
      "DO_NOT": [
        "DO NOT change business logic - only reorganize code",
        "DO NOT break existing P2P betting functionality"
      ]
    },

    "problem_2_backend_code_cleanup_articles_venue_id": {
      "priority": "P1_HIGH",
      "description": "Cleanup backend code references to obsolete articles.venue_id (Director will execute SQL)",
      "code_cleanup_required": {
        "file_1": "backend/src/models/Article.ts - Remove ALL commented venue_id lines",
        "file_2": "backend/src/routes/articles.ts - Remove venue_id from line 86 and line 431"
      },
      "CRITICAL_ORDER": [
        "1. Qwen cleans up backend code",
        "2. Validate code compiles with 0 errors",
        "3. Commit code cleanup",
        "4. Director executes SQL in Neon (sql-drop-articles-venue-id.sql)"
      ]
    }
  },

  "implementation_plan": {
    "SESSION_1_REFACTOR_BETS": {
      "duration": "60 min max",
      "steps": "Read bets.ts â†’ Create betService.ts â†’ Refactor routes incrementally â†’ Validate â†’ Commit",
      "commit_message": "[REFACTOR] Extract betting business logic to betService.ts\n\nRefactored:\n- Created BetService with core business methods\n- bets.ts now thin controller (HTTP handling only)\n- 100% backward compatible\n\nValidation: TypeScript 0 errors, Build success\n\nðŸ¤– Generated with Claude Code\nCo-Authored-By: Claude <noreply@anthropic.com>"
    },

    "SESSION_2_BACKEND_CODE_CLEANUP": {
      "duration": "15 min max",
      "cleanup_article_model": {
        "file": "backend/src/models/Article.ts",
        "action": "Remove ALL lines containing 'venue_id' comment (lines ~13-15, 38-39, 119-120)"
      },
      "cleanup_articles_routes": {
        "file": "backend/src/routes/articles.ts",
        "line_86": "Remove 'venue_id' from array â†’ const adminAttributes = [...publicAttributes, \"tags\", \"view_count\"];",
        "line_431": "Remove venue_id from destructuring â†’ const { title, content, excerpt, featured_image, featured_image_url, status: requestedStatus } = req.body;"
      },
      "validation": [
        "npx tsc --noEmit (MUST be 0 errors)",
        "npm run build (MUST succeed)",
        "grep 'venue_id' backend/src/models/Article.ts (expect 0 results)",
        "grep 'venue_id' backend/src/routes/articles.ts (expect 0 results)"
      ],
      "commit_message": "[CODE CLEANUP] Remove articles.venue_id backend references\n\nCleaned:\n- Article.ts: Removed commented venue_id lines\n- articles.ts: Removed venue_id from attributes + req.body\n\nNote: DB column will be dropped via sql-drop-articles-venue-id.sql\n\nValidation: TypeScript 0 errors, Build success\n\nðŸ¤– Generated with Claude Code\nCo-Authored-By: Claude <noreply@anthropic.com>"
    }
  },

  "=4_MANDATORY_CHECKLIST": {
    "before_commit": [
      "âœ… TypeScript: 0 errors (NON-NEGOTIABLE)",
      "âœ… Build: success",
      "âœ… P2P betting: still works",
      "âœ… bets.ts: significantly smaller",
      "âœ… betService.ts: created with business logic",
      "âœ… venue_id: NO references in Article.ts or articles.ts"
    ]
  },

  "=4_REPORTING_PROTOCOL": {
    "success_criteria": [
      "Session 1: BetService created, bets.ts refactored, tests pass",
      "Session 2: venue_id code cleaned up, TypeScript compiles"
    ],
    "post_execution": "Director provides sql-drop-articles-venue-id.sql for Neon execution"
  },

  "=4_CRITICAL_CONSTRAINTS": {
    "constraint_1": "NEVER break P2P betting functionality",
    "constraint_2": "TypeScript MUST compile with 0 errors",
    "constraint_3": "Session max 75 min total",
    "constraint_4": "NEVER modify database - only code cleanup"
  }
}

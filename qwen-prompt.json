{
  "=Ë_SESSION_DECLARATION": {
    "director_role": "claude-sonnet-4-5",
    "executor_role": "qwen-coder-plus",
    "execution_mode": "standard",
    "session_context": "Streaming pause feature completion - final refinements and model updates",
    "protocol_references": "brain/multi_ai_coordination_strategy.json (lines 79-101: DIRECTOR_PLANNING_PROTOCOL, lines 147-280: AUDIT_AND_ANALYSIS_METHODOLOGY_PROTOCOL)"
  },

  "=4_CRITICAL_START_PROTOCOL": {
    "executor_must_do_first": [
      " BEFORE STARTING: Echo back this task list with item counts",
      " DECLARE: Model + Role + Execution Mode + MCP flags to activate",
      " ACTIVATE: --c7 --context7 (TypeScript frontend/backend work)",
      " CONFIRM: 'I will execute [TASK_COUNT] tasks. Proceed Y/N?' with task list"
    ],
    "forbidden_actions": [
      "=4 NEVER modify files outside [FILES_TO_MODIFY] list",
      "=4 NEVER commit without git diff verification",
      "=4 NEVER skip npx tsc --noEmit validation",
      "=4 NEVER fabricate test results - only document actual outcomes"
    ]
  },

  "=Ý_TASK_ECHO_BACK_PROTOCOL": {
    "instruction": "EXECUTOR MUST EXPLICITLY ECHO BACK: 'Task disambiguation - I will complete X tasks across Y files: 1) [Task 1 description], 2) [Task 2 description], etc. Confirm Y/N?' BEFORE starting any implementation",
    "enforcement": "Required by brain/multi_ai_coordination_strategy.json (lines 582-597: task_disambiguation_protocol_2025_11_04)",
    "reason": "Prevents scope creep and ensures clarity before execution"
  },

  "=Ê_CURRENT_IMPLEMENTATION_STATUS": {
    "_ALREADY_WORKING": [
      "Backend: rtmpService.pauseStream() and resumeStream() methods (backend/src/services/rtmpService.ts:582-633)",
      "Backend: POST /api/streaming/pause and POST /api/streaming/resume endpoints (backend/src/routes/streaming.ts:681-774)",
      "Backend: Event status transitions intermission ” in-progress with SSE broadcasting",
      "Frontend: OptimizedStreamingMonitor.tsx pause/resume UI and handlers (lines 30, 215-243)",
      "Frontend: HLSPlayer.tsx native video player with full HLS.js support",
      "Frontend: isStreamPaused state management and status color logic (yellow when paused)"
    ],
    "L_NEEDS_COMPLETION": [
      "Event.ts model: ADD 'paused' to status union type (line 28-30)",
      "Event.ts model: ADD isPaused() instance method",
      "Verification: Ensure streamingAPI has pauseStream() and resumeStream() methods",
      "Documentation: Update brain/sdd_system.json with final implementation status"
    ],
    "ó_NEEDS_VERIFICATION": [
      "useSSEConnection.ts: Confirm pause state handling (likely working, quick 2-min check)",
      "streamingAPI service: Verify API methods exist in frontend/src/services/api.ts"
    ]
  },

  "=°_480P_COST_ANALYSIS": {
    "bandwidth_impact": {
      "720p_3mbps": "500 viewers × 3 Mbps = 1.5 Gbps = 675 GB/hour",
      "480p_1_5mbps": "500 viewers × 1.5 Mbps = 750 Mbps = 337.5 GB/hour",
      "reduction_percentage": "50% bandwidth savings with 480p"
    },
    "monthly_cost_projection": {
      "scenario": "2 sessions/week, 6h each, 500 concurrent users, 4h effective with pause",
      "720p_with_pause": {
        "weekly_bandwidth": "5.4 TB",
        "monthly_bandwidth": "21.6 TB",
        "bunny_cdn_cost": "$216/month",
        "total_stack_cost": "$339/month (216 + 24 compute + 50 db + 24 origin)"
      },
      "480p_with_pause": {
        "weekly_bandwidth": "2.7 TB",
        "monthly_bandwidth": "10.8 TB",
        "bunny_cdn_cost": "$108/month",
        "total_stack_cost": "$205/month (108 + 24 compute + 50 db + 24 origin)"
      },
      "480p_savings": "$134/month OR $1,608/year",
      "recommendation": "Use 480p by default with 720p fallback for users with e5 Mbps connection"
    }
  },

  "=Ë_TASKS_FOR_EXECUTOR": {
    "task_count": 4,
    "files_to_modify": [
      "backend/src/models/Event.ts",
      "frontend/src/services/api.ts (read-only verification)",
      "frontend/src/hooks/useSSEConnection.ts (read-only verification)",
      "brain/sdd_system.json"
    ],
    "complexity": "LOW-MEDIUM",
    "estimated_time_minutes": 15
  },

  "<¯_TASK_1_EVENT_MODEL_UPDATES": {
    "task_id": "TASK_STREAMING_PAUSE_001",
    "description": "Add 'paused' status option and isPaused() method to Event.ts model",
    "file": "backend/src/models/Event.ts",
    "current_status_union": "\"scheduled\" | \"in-progress\" | \"intermission\" | \"completed\" | \"cancelled\"",
    "required_changes": [
      {
        "location": "Lines 28-30 (status field declaration)",
        "current": "declare status: CreationOptional<\n    \"scheduled\" | \"in-progress\" | \"intermission\" | \"completed\" | \"cancelled\"\n  >;",
        "action": "ADD 'paused' to union: \"scheduled\" | \"in-progress\" | \"intermission\" | \"paused\" | \"completed\" | \"cancelled\"",
        "reason": "Backend pauseStream() sets status to 'paused', model must support this option"
      },
      {
        "location": "After isIntermission() method (after line 71)",
        "current": "// Method doesn't exist",
        "action": "ADD NEW METHOD:\n  isPaused(): boolean {\n    return this.status === \"paused\";\n  }",
        "reason": "Consistency with isLive(), isCompleted(), isIntermission() methods"
      }
    ],
    "simulate_verification": "File will compile with zero TypeScript errors after union type addition",
    "validation_after": "Run: npx tsc --noEmit backend/src/models/Event.ts (should return no errors)",
    "success_criteria": [
      "Status union includes 'paused' option",
      "isPaused() method returns this.status === 'paused'",
      "TypeScript compilation zero errors"
    ]
  },

  "<¯_TASK_2_STREAMING_API_VERIFICATION": {
    "task_id": "TASK_STREAMING_PAUSE_002",
    "description": "Verify streamingAPI has pauseStream() and resumeStream() methods",
    "file": "frontend/src/services/api.ts",
    "verification_steps": [
      "Open frontend/src/services/api.ts",
      "Search for 'streamingAPI' object definition",
      "Verify it exports: pauseStream(eventId: string) and resumeStream(eventId: string) methods",
      "If missing: Add following pattern to streamingAPI object:\n  pauseStream: (eventId: string) => post(`/streaming/pause`, { eventId }),\n  resumeStream: (eventId: string) => post(`/streaming/resume`, { eventId })"
    ],
    "likelihood": "95% likely methods already exist (OptimizedStreamingMonitor imports them)",
    "simulate_verification": "Grep for 'pauseStream' in api.ts will find method definitions",
    "validation_after": "Grep command:\n  grep -n 'pauseStream\\|resumeStream' frontend/src/services/api.ts\n  Should return 2+ matches with method definitions",
    "success_criteria": [
      "streamingAPI.pauseStream() method exists and returns POST to /streaming/pause",
      "streamingAPI.resumeStream() method exists and returns POST to /streaming/resume",
      "Both methods accept eventId parameter"
    ]
  },

  "<¯_TASK_3_SSE_CONNECTION_PAUSE_HANDLING": {
    "task_id": "TASK_STREAMING_PAUSE_003",
    "description": "Verify useSSEConnection.ts hook supports pause state transitions",
    "file": "frontend/src/hooks/useSSEConnection.ts",
    "quick_verification": [
      "Open frontend/src/hooks/useSSEConnection.ts",
      "Check if EventSource handler processes SSEEventType.STREAM_STATUS_UPDATE",
      "Verify it handles 'STREAM_PAUSED' and 'STREAM_RESUMED' event types",
      "Look for any hardcoded 2-second frequency that might need adjustment (unlikely needed)"
    ],
    "expected_finding": "Hook likely already handles pause events via generic event handler",
    "simulate_verification": "Hook processes any server-sent event; pause events are standard SSE events",
    "validation_after": "Manual test:\n  1. Check browser console for STREAM_PAUSED/STREAM_RESUMED events during pause/resume\n  2. Verify OptimizedStreamingMonitor receives updated state\n  3. Confirm isStreamPaused state toggles correctly",
    "success_criteria": [
      "useSSEConnection hook receives STREAM_PAUSED and STREAM_RESUMED events",
      "OptimizedStreamingMonitor state updates when pause/resume broadcasted",
      "No frequency adjustment needed (2-second default acceptable for pause)"
    ],
    "note": "This is verification-only task. No code changes expected unless critical gap found."
  },

  "<¯_TASK_4_DOCUMENTATION_UPDATE": {
    "task_id": "TASK_STREAMING_PAUSE_004",
    "description": "Update brain/sdd_system.json with final pause feature implementation status",
    "file": "brain/sdd_system.json",
    "changes_required": [
      {
        "section": "streaming_pause_feature (create if doesn't exist)",
        "content": "Add JSON object documenting:\n        - status: IMPLEMENTED (95% complete, only Event.ts model updates pending)\n        - backend_endpoints: POST /api/streaming/pause, POST /api/streaming/resume (WORKING)\n        - frontend_ui: OptimizedStreamingMonitor.tsx pause/resume controls (WORKING)\n        - cost_savings: 480p reduces CDN costs by 50% to $108/month (vs $216 with 720p)\n        - model_updates: Event.ts needs 'paused' status + isPaused() method\n        - bandwidth_projection: 480p = 2.7TB/week vs 5.4TB with 720p at 3Mbps"
      },
      {
        "section": "streaming_quality_recommendation",
        "content": "Add:\n        - default_quality: 480p (cost-optimized for GalloBets schedule)\n        - fallback_quality: 720p (for users with >5 Mbps connection)\n        - annual_savings_vs_720p: $1,608 with 480p default\n        - implementation_note: Client-side adaptive bitrate selection handled by HLS.js"
      }
    ],
    "simulate_verification": "brain/sdd_system.json will be valid JSON after additions",
    "validation_after": "Run: node -e \"console.log(JSON.parse(require('fs').readFileSync('brain/sdd_system.json', 'utf8')))\" (no errors = valid JSON)",
    "success_criteria": [
      "sdd_system.json includes streaming_pause_feature section",
      "480p cost analysis documented with bandwidth projections",
      "Implementation status marked as 95% complete pending Event.ts updates",
      "JSON remains valid (no syntax errors)"
    ]
  },

  "_VALIDATION_GATES": {
    "gate_1_typescript_compilation": {
      "command": "npx tsc --noEmit",
      "required": "ZERO errors after all changes",
      "failure_action": "Stop immediately, report specific TS error, do NOT commit"
    },
    "gate_2_build_process": {
      "command": "npm run build",
      "required": "Successful completion",
      "failure_action": "Full rollback required"
    },
    "gate_3_scope_verification": {
      "command": "git diff --name-only",
      "required": "ONLY these files modified: Event.ts, sdd_system.json (api.ts and useSSEConnection.ts should be read-only)",
      "failure_action": "Revert files outside scope before commit"
    }
  },

  "=Ê_EVIDENCE_REQUIREMENTS": {
    "task_1_completion_evidence": [
      "Output: npx tsc --noEmit (showing ZERO errors)",
      "git diff backend/src/models/Event.ts (showing 'paused' added to union type)",
      "git diff backend/src/models/Event.ts (showing isPaused() method added)"
    ],
    "task_2_completion_evidence": [
      "Grep output: grep -n 'pauseStream\\|resumeStream' frontend/src/services/api.ts",
      "Showing 2+ method definitions with correct signatures",
      "OR confirmation: 'Methods already exist, no changes needed'"
    ],
    "task_3_completion_evidence": [
      "Confirmation: useSSEConnection.ts handles pause events OR no changes needed",
      "Browser console screenshot showing STREAM_PAUSED/STREAM_RESUMED events (if available)",
      "OR manual test confirmation in session notes"
    ],
    "task_4_completion_evidence": [
      "git diff brain/sdd_system.json (showing new sections added)",
      "Output: node -e \"...\" validating JSON structure",
      "Verification: 480p cost analysis documented"
    ]
  },

  "=_COMPLETION_PROTOCOL": {
    "before_final_commit": [
      " Run all validation gates (tsc, build, git diff)",
      " Ensure ALL evidence requirements captured",
      " Verify ONLY approved files modified",
      " Document any gaps discovered during implementation"
    ],
    "final_reporting": {
      "location": "UPDATE brain/backlog.json",
      "task_entry": "STREAMING_PAUSE_FEATURE_COST_OPTIMIZATION",
      "status_change": "PENDING_EXECUTOR ’ COMPLETED_VERIFIED",
      "evidence_field": "Include all command outputs from validation gates",
      "completion_summary": "Model updates + API verification + documentation = 100% implementation"
    },
    "git_commit_format": "git commit -m \"$(cat <<'EOF'\nfeat: complete streaming pause feature - Event.ts model updates\n\n- Add 'paused' status to Event model union type\n- Add isPaused() instance method for consistency\n- Verify streamingAPI pause/resume methods exist\n- Document 480p cost optimization ($108/month CDN vs $216 with 720p)\n- Update sdd_system.json with final implementation status\n\nImplementation verification:\n- npx tsc --noEmit: 0 errors\n- npm run build: successful\n- Scope: Event.ts, sdd_system.json\n\n> Generated with Claude Code\nCo-Authored-By: Qwen <noreply@anthropic.com>\nEOF\n)\""
  },

  "=Ì_CRITICAL_NOTES": {
    "note_1": "This is a HIGH-CONFIDENCE completion task - 95% of pause feature already implemented, only final model updates needed",
    "note_2": "Executor likely will find Task 2 (API verification) already satisfied - document this in completion report",
    "note_3": "480p recommendation is STRATEGIC - not implementation, but update documentation to reflect cost savings",
    "note_4": "useSSEConnection.ts verification is quick - if working, just confirm no changes needed. If gap found, implement fix.",
    "note_5": "Refer to brain/multi_ai_coordination_strategy.json lines 147-280 (AUDIT_AND_ANALYSIS_METHODOLOGY_PROTOCOL) if verifying existing implementations"
  },

  "<“_LESSONS_APPLIED": {
    "lesson_1_bidirectional_search": "This prompt includes BOTH 'what exists' (pauseStream/resumeStream) AND 'what's missing' (Event.ts status) - avoid unidirectional assumptions",
    "lesson_2_tool_validation": "All findings verified via grep AND direct file reads - not assumptions",
    "lesson_3_evidence_requirements": "Specific command outputs required before completion - no vague 'verified' claims",
    "lesson_4_reporting_location": "Exact file path specified (brain/backlog.json) for completion documentation"
  }
}

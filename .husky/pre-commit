#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Optimized pre-commit hooks for faster development
# Focus on essential quality checks without blocking commits

echo "üîç Running pre-commit quality checks..."

# Get current directory
CURRENT_DIR=$(pwd)

# 1. Frontend linting with increased warning tolerance (500 warnings)
echo "üìù Checking frontend code quality..."
cd "$CURRENT_DIR/frontend" || exit 1
npm run lint:commit || {
  echo "‚ùå Lint check failed. Run 'npm run lint:fix' to fix automatically."
  exit 1
}

# 2. Formatting (non-blocking, auto-fix)
echo "üé® Auto-formatting code..."
npm run format > /dev/null 2>&1 || true

# 3. Backend basic check (lightweight)
echo "üîß Checking backend syntax..."
if [ -f "$CURRENT_DIR/backend/package.json" ]; then
  cd "$CURRENT_DIR/backend" || exit 1
  # Only check for basic syntax errors, not full typecheck
  if npm list typescript > /dev/null 2>&1; then
    npx tsc --noEmit --skipLibCheck || {
      echo "‚ö†Ô∏è  TypeScript errors found in backend. Consider fixing before push."
      # Don't exit - allow commit but warn
    }
  fi
fi

echo "‚úÖ Pre-commit checks completed!"
cd "$CURRENT_DIR"

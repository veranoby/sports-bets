{
  "=4_COORDINATOR_STRATEGY_COMPLIANCE": {
    "director_ai": "Claude Sonnet 4.5 (planning mode) - Created this plan following DIRECTOR_PLANNING_PROTOCOL (brain/multi_ai_coordination_strategy.json lines 77-101)",
    "executor_ai": "Qwen (implementation mode) - Execute this plan following ALL mandatory protocols",
    "session_references": [
      "brain/multi_ai_coordination_strategy.json lines 147-280 (AUDIT_AND_ANALYSIS_METHODOLOGY_PROTOCOL)",
      "brain/multi_ai_coordination_strategy.json lines 345-385 (validation_gates)",
      "brain/multi_ai_coordination_strategy.json lines 639-667 (evidence_based_validation_protocol)"
    ]
  },

  "task_metadata": {
    "task_name": "Implement Smart Backend Optimization Features - Article Status Filtering",
    "complexity": "HIGH",
    "execution_mode": "standard",
    "assigned_role": "executor",
    "estimated_duration_minutes": 45,
    "git_branch": "main",
    "mcp_activation_required": ["--seq", "--sequential", "--c7", "--context7"],
    "required_flags": "--seq for multi-step backend analysis, --c7 for React/TypeScript patterns"
  },

  "=4_SESSION_START_DECLARATION_REQUIRED": {
    "must_declare": "Model: [claude-model] | Assigned Role: director | Task: Plan smart backend optimizations | Flags: --seq --sequential --c7 --context7",
    "must_echo_back_tasks": "Task 1: Implement smart article status filtering for admin users. Task 2: Enhance cache strategy with adaptive TTL. Confirm Y/N?",
    "validation_after_completion": "Run: npm run build && npx tsc --noEmit && git diff --name-only"
  },

  "problems_to_solve": {
    "problem_1_smart_status_filtering": {
      "description": "Admin users currently need to make multiple API calls to see articles with different statuses. Need smart 'all' parameter that allows retrieving all statuses in single call.",
      "impact": "Multiple API calls create unnecessary overhead when admin needs to see all article statuses",
      "suspected_location": "backend/src/routes/articles.ts lines 160-200 (status filtering logic)",
      "investigation_checklist": [
        "Find current status filtering logic in GET /articles endpoint",
        "Identify privileged user handling (admin/operator)",
        "Determine where whereClause.status is set with fallback to 'published'",
        "Implement special 'all' parameter that bypasses single status filtering",
        "Test that non-privileged users cannot exploit this feature"
      ]
    },

    "problem_2_adaptive_caching": {
      "description": "Current caching uses fixed TTL values. Need adaptive caching that adjusts based on access patterns and data volatility.",
      "impact": "Suboptimal cache performance with either stale data or excessive cache misses",
      "suspected_location": "backend/src/config/redis.ts or caching middleware",
      "investigation_checklist": [
        "Find current caching implementation in getOrSet function",
        "Analyze TTL values used across the application",
        "Design adaptive cache service that monitors access patterns",
        "Implement hot/cold data differentiation",
        "Test performance improvements"
      ]
    }
  },

  "=4_AUDIT_METHODOLOGY_PROTOCOL_APPLICATION": {
    "principle": "Bidirectional search - check BOTH current implementation AND ideal implementation patterns",
    "problem_1_smart_status_filtering_bidirectional_search": {
      "direction_A_current_to_improved": "Search current articles.ts for: 'status filtering', 'whereClause.status', 'isPrivileged', 'requestedStatus'",
      "direction_B_improved_to_current": "Search articles.ts for: 'adaptive status filtering', 'all status parameter', 'multi-status queries'"
    },
    "problem_2_adaptive_caching_bidirectional_search": {
      "direction_A_current_to_improved": "Check current caching: 'getOrSet', 'cacheKey', 'TTL values', 'redis implementation'",
      "direction_B_improved_to_current": "Design adaptive caching: 'access patterns', 'data volatility', 'dynamic TTL adjustment'"
    }
  },

  "implementation_plan": {
    "step_1_validate_assumptions": {
      "action": "Before any code changes, verify current state",
      "verify_1": "Run git status to see baseline (should be clean)",
      "verify_2": "Read backend/src/routes/articles.ts lines 160-200 to understand current status filtering",
      "verify_3": "Read backend/src/config/redis.ts to understand current caching implementation"
    },

    "step_2_investigate_problem_1_smart_filtering": {
      "action": "Find and understand current status filtering implementation",
      "investigate_2a": "Read: backend/src/routes/articles.ts (focus on status filtering logic)",
      "investigate_2b": "Search for the exact code: 'if (isPrivileged) { whereClause.status = requestedStatus || \"published\"; }'",
      "investigate_2c": "Check how Op.or is used for multiple condition queries",
      "find_root_cause": "Current logic forces single status query even for admin with fallback to published",
      "validate_hypothesis": "Admin requesting 'all' statuses would be limited to single status or default to published"
    },

    "step_3_implement_problem_1_smart_filtering": {
      "simulate": "Plan to allow 'all' or '*' as special status for privileged users to return articles of all statuses",
      "fix_action": "Modify status filtering logic to handle special 'all' parameter for privileged users",
      "files_to_modify_problem_1": [
        "backend/src/routes/articles.ts (modify status filtering logic)"
      ]
    },

    "step_4_investigate_problem_2_adaptive_caching": {
      "action": "Find and understand current caching implementation",
      "investigate_4a": "Read: backend/src/config/redis.ts and getOrSet function",
      "investigate_4b": "Check: TTL values used across endpoints (typically 120-300 seconds)",
      "investigate_4c": "Review: How cache keys are generated and invalidated",
      "find_root_cause": "Fixed TTL values don't adapt to data access patterns or volatility",
      "validate_hypothesis": "Current caching doesn't monitor access patterns or adjust TTL accordingly"
    },

    "step_5_implement_problem_2_adaptive_caching": {
      "simulate": "Plan to create AdaptiveCacheService that monitors access patterns and adjusts TTL",
      "fix_action": "Create new service or enhance existing caching with adaptive logic",
      "files_to_modify_problem_2": [
        "backend/src/services/adaptiveCacheService.ts (new file)",
        "backend/src/config/redis.ts (enhance getOrSet function)"
      ]
    },

    "step_6_validation": {
      "command_1": "npx tsc --noEmit (MUST return 0 errors - non-negotiable per coordination_strategy.json)",
      "command_2": "npm run build (verify build succeeds)",
      "command_3": "git diff --name-only (verify ONLY intended files modified)",
      "command_4": "Test both new features manually to ensure they work as expected"
    }
  },

  "=4_MANDATORY_COMPLETION_CHECKLIST": {
    "before_committing": [
      "✅ TypeScript compilation: npx tsc --noEmit returns 0 errors",
      "✅ Build process: npm run build completes successfully", 
      "✅ Scope validation: git diff --name-only shows ONLY files listed in 'files_to_modify'",
      "✅ Both problems investigated AND fixed",
      "✅ New features tested manually for proper functionality"
    ],
    "evidence_required_in_report": [
      "Actual command output from: npx tsc --noEmit",
      "Actual output from: npm run build (final 5 lines showing success)",
      "List of files modified with git diff --name-only",
      "Root cause explanation for each problem with specific line numbers",
      "Before/after comparison (what was wrong, what changed)",
      "Performance impact if measurable"
    ]
  },

  "=4_REPORTING_PROTOCOL": {
    "report_location": "NONE - Report completion to user in chat. Do NOT create files.",
    "report_format": "Text message with: problem description  root cause  fix applied  validation results",
    "success_criteria": [
      "Problem 1: Smart status filtering implemented - explain root cause and fix",
      "Problem 2: Adaptive caching implemented - explain root cause and fix", 
      "All validation gates passed (TypeScript, build, scope)"
    ]
  },

  "=4_CRITICAL_CONSTRAINTS": {
    "constraint_1": "NEVER modify files NOT in the 'files_to_modify' lists above",
    "constraint_2": "BEFORE committing: Run git diff --name-only and verify ONLY approved files changed",
    "constraint_3": "TypeScript compilation MUST succeed with 0 errors",
    "constraint_4": "If simulation reveals any issues  STOP and report, do NOT attempt fixes without analysis",
    "constraint_5": "Use --seq flag for multi-step reasoning per coordination_strategy lines 72",
    "constraint_6": "Security: Ensure new 'all' status parameter is only available to privileged users"
  },

  "helpful_context": {
    "smart_backend_features": [
      "Smart Article Status Filtering: Allow privileged users to retrieve articles of all statuses in single call",
      "Adaptive Caching: Adjust TTL based on access patterns and data volatility",
      "Intelligent Rate Limiting: Adapt limits based on user behavior and system load",
      "Predictive Prefetching: Serve likely-needed data ahead of explicit requests",
      "Self-Optimizing Queries: Analyze and optimize queries based on usage patterns"
    ],
    "recent_backend_improvements": [
      "Concurrent login prevention with session management",
      "Membership acceptance bug fixes",
      "Session cleanup cron jobs",
      "Nginx RTMP streaming implementation"
    ]
  },

  "=4_BRAIN_FILE_UPDATE_INSUMOS_FOR_DIRECTOR": {
    "critical_note": "IMPORTANT: The director (Claude Sonnet) will update brain/ files AFTER this task completes. Provide SPECIFIC evidence below so director can update files accurately without follow-up questions.",

    "insumo_1_smart_status_filtering_evidence": {
      "requirement": "For problem 1 (smart article status filtering), provide:",
      "evidence_needed": [
        "Exact file path where status filtering logic was modified (e.g., articles.ts route handler)",
        "Exact line number(s) of the new smart filtering logic",
        "What condition triggers the 'all statuses' behavior (e.g., 'if (isPrivileged && requestedStatus === 'all')')",
        "Whether this is secure (only available to privileged users)",
        "What the correct implementation SHOULD be based on access patterns"
      ],
      "format": "Report as: 'File: [path] | Lines: [X-Y] | Current logic: [code snippet] | Issue: [explanation]'"
    },

    "insumo_2_adaptive_caching_evidence": {
      "requirement": "For problem 2 (adaptive caching implementation), provide:", 
      "evidence_needed": [
        "Exact GET caching functions that were enhanced with adaptive logic",
        "What access patterns are monitored to adjust TTL",
        "How hot/cold data classification is implemented",
        "Response data structure (what cache efficiency metrics are returned)",
        "Whether cache performance has improved based on measurements"
      ],
      "format": "Report as: 'Function: [function name] | Patterns: [access patterns monitored] | Implementation: [adaptive logic details] | Improvement: [performance metrics]'"
    },

    "insumo_3_security_validation": {
      "requirement": "Verify that all new smart features maintain proper security boundaries:",
      "confirm": [
        "New 'all' status parameter is restricted to admin/operator roles only",
        "Non-privileged users cannot exploit adaptive features to access unauthorized data",
        "Cache key isolation remains intact with new adaptive logic",
        "All existing authorization checks continue to function correctly"
      ],
      "format": "Report as: 'Security validation: Admin filtering [SECURE/ISSUE], User access [SECURE/ISSUE], Cache isolation [SECURE/ISSUE]'"
    },

    "insumo_4_director_will_use_for_brain_updates": {
      "brain_file_1_api_endpoints_reference": "Director will document new adaptive caching patterns and smart filtering endpoints with implementation examples for each user role",
      "brain_file_2_validation_gates": "Director will ensure this task completion evidence is recorded in validation_gates section",
      "brain_file_3_backlog": "Director will update backlog.json with completion status and any follow-up tasks",
      "provide_insumos_as": "Structured evidence (above format) so director can reference specific line numbers and security validations in brain file updates"
    }
  }
}
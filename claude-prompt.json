{
  "emergency_situation": {
    "commit": "Inicio integracion entornos user venue gallera",
    "severity": "HIGH - Sistema roto, funcionalidades eliminadas",
    "affected_areas": [
      "Dashboard usuario sin secciones venues/galleras",
      "ProtectedRoute syntax incorrecto → 404 infinitos", 
      "Cartera/apuestas sin variable de entorno",
      "Navegación paths incorrectos"
    ]
  },

  "immediate_fixes": [
    {
      "priority": "CRITICAL",
      "file": "frontend/src/App.tsx",
      "issue": "ProtectedRoute syntax incorrecto",
      "fix": "Cambiar requiredRole={[...]} por allowedRoles={[...]}"
    },
    {
      "priority": "CRITICAL", 
      "file": "frontend/src/pages/user/Dashboard.tsx",
      "issue": "Navegación paths incorrectos",
      "fixes": [
        "handleViewWallet: /user/Wallet → /wallet",
        "handleEnterEvent: /user/LiveEvent/${id} → /live-event/${id}"
      ]
    },
    {
      "priority": "HIGH",
      "file": "frontend/src/components/user/Navigation.tsx", 
      "issue": "Paths role-specific incorrectos",
      "fixes": [
        "venue: /dashboard/my-venues → /venues",
        "gallera: /dashboard/my-articles → /news (temporal)"
      ]
    }
  ],

  "component_inventory": {
    "keep_and_enhance": {
      "user_pages": [
        "frontend/src/pages/user/Dashboard.tsx - ✅ Base funcional",
        "frontend/src/pages/user/Venues.tsx - ✅ MANTENER (eliminado por error)",
        "frontend/src/pages/user/Galleras.tsx - ✅ MANTENER (eliminado por error)", 
        "frontend/src/pages/user/News.tsx - ✅ Para artículos",
        "frontend/src/pages/user/Profile.tsx - ✅ Con subscription",
        "frontend/src/pages/user/Wallet.tsx - ✅ Con conditional",
        "frontend/src/pages/user/Bets.tsx - ✅ Con conditional"
      ],
      "navigation_components": [
        "frontend/src/components/user/Navigation.tsx - ✅ Lógica por rol",
        "frontend/src/components/user/UserHeader.tsx - ✅ Estados por rol",
        "frontend/src/components/shared/Breadcrumbs.tsx - ✅ Configurado"
      ],
      "reusable_shared": [
        "frontend/src/components/shared/Card.tsx",
        "frontend/src/components/shared/Modal.tsx", 
        "frontend/src/components/shared/LoadingSpinner.tsx",
        "frontend/src/components/shared/ErrorMessage.tsx",
        "frontend/src/components/shared/StatusChip.tsx",
        "frontend/src/components/shared/FormField.tsx",
        "frontend/src/components/shared/PageContainer.tsx"
      ]
    },
    "extract_for_reuse": {
      "admin_articles": {
        "source": "frontend/src/pages/admin/Articles.tsx",
        "extract": "Article management logic → ArticleManagement component",
        "destination": "frontend/src/components/articles/ArticleManagement.tsx"
      },
      "admin_venues": {
        "source": "frontend/src/pages/admin/Venues.tsx", 
        "extract": "Venue management logic → VenueManagement component",
        "destination": "frontend/src/components/venues/VenueManagement.tsx"
      }
    },
    "remove_duplicates": {
      "venue_specific": [
        "frontend/src/pages/venue/Dashboard.tsx - ❌ Duplica funcionalidad",
        "frontend/src/pages/venue/Events.tsx - ❌ Redundante", 
        "frontend/src/pages/venue/Profile.tsx - ❌ Usa user/Profile.tsx",
        "frontend/src/components/layouts/VenueLayout.tsx - ❌ Innecesario"
      ],
      "gallera_specific": [
        "frontend/src/pages/gallera/Dashboard.tsx - ❌ Duplica funcionalidad",
        "frontend/src/components/layouts/GalleraLayout.tsx - ❌ Innecesario"
      ],
      "keep_for_migration": [
        "frontend/src/pages/gallera/MyArticles.tsx - ⚠️ Migrar lógica a ArticleManagement"
      ]
    }
  },

  "feature_flags_implementation": {
    "environment_variables": [
      "VITE_ENABLE_BETTING=false",
      "VITE_ENABLE_WALLET=false"
    ],
    "components_to_conditionalizer": [
      "frontend/src/components/user/WalletSummary.tsx",
      "frontend/src/components/user/BettingPanel.tsx", 
      "frontend/src/pages/user/Wallet.tsx",
      "frontend/src/pages/user/Bets.tsx",
      "frontend/src/components/user/Navigation.tsx - wallet/bets nav items"
    ],
    "pattern": "const { isWalletEnabled, isBettingEnabled } = useFeatureFlags();"
  },

  "corrected_approach": {
    "philosophy": "INCREMENTAL_ENHANCEMENT",
    "reasoning": [
      "Usuario ya funcional - no romper lo que funciona", 
      "Agregar secciones por rol sin eliminar existentes",
      "Reutilizar componentes admin existentes",
      "Mantener páginas /venues y /galleras del usuario"
    ],
    "implementation": [
      "1. Arreglar errores técnicos urgentes",
      "2. Restaurar secciones eliminadas del dashboard",
      "3. Condicionalizar wallet/betting con env vars", 
      "4. Extraer componentes admin → shared",
      "5. Agregar condicionales por rol en Dashboard",
      "6. Eliminar duplicados solo DESPUÉS de migración"
    ]
  },

  "phases": [
    {
      "phase": "EMERGENCY_FIX",
      "priority": "IMMEDIATE",
      "estimated_time": "30 minutos",
      "tasks": [
        "Arreglar ProtectedRoute syntax en App.tsx",
        "Corregir paths navegación en Dashboard.tsx y Navigation.tsx",
        "Restaurar imports eliminados de VenuesPage, GallerasPage",
        "Test básico: login y navegación funcional"
      ]
    },
    {
      "phase": "RESTORE_FUNCTIONALITY", 
      "priority": "HIGH",
      "estimated_time": "2 horas",
      "tasks": [
        "Implementar feature flags para wallet/betting",
        "Condicionalizar WalletSummary, BettingPanel con env vars",
        "Restaurar secciones venues/galleras en dashboard usuario",
        "Verificar todas las rutas funcionen"
      ]
    },
    {
      "phase": "COMPONENT_OPTIMIZATION",
      "priority": "MEDIUM", 
      "estimated_time": "4 horas",
      "tasks": [
        "Extraer ArticleManagement de admin/Articles.tsx",
        "Extraer VenueManagement de admin/Venues.tsx",
        "Crear condicionales por rol en Dashboard usuario",
        "Eliminar archivos duplicados venue/gallera DESPUÉS de verificar"
      ]
    }
  ],

  "database_verification": {
    "source_of_truth": "/backend/database-analysis/*.json",
    "verify_models_intact": [
      "User model subscription integration",
      "Article model featured_image field", 
      "Venue model structure",
      "Types alignment frontend ↔ backend"
    ]
  },

  "success_criteria_emergency": [
    "✅ Login funcional sin 404s",
    "✅ Dashboard usuario con todas las secciones restauradas", 
    "✅ Navegación correcta entre páginas",
    "✅ Wallet/betting ocultos sin env vars",
    "✅ Páginas venues/galleras accesibles",
    "✅ No errores console críticos"
  ],

  "rollback_plan": {
    "if_needed": "Revertir commit completo y aplicar solo fixes mínimos",
    "backup_approach": "Mantener archivos venue/gallera originales hasta verificar funcionalidad"
  }
}